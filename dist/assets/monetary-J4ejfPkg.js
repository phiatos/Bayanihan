import"./global-Dd8t204S.js";/* empty css                *//* empty css               */document.addEventListener("DOMContentLoaded",()=>{const X={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};firebase.initializeApp(X);const h=firebase.database(),$=firebase.auth(),a=document.getElementById("form-container-1"),I=document.querySelector("#monetaryTable tbody"),x=document.getElementById("searchInput"),S=document.getElementById("sortSelect"),U=document.getElementById("exportBtn"),K=document.getElementById("savePdfBtn"),R=document.getElementById("entriesInfo"),y=document.getElementById("pagination"),W=document.getElementById("clearFormBtn"),M=document.getElementById("editModal"),w=10;let m=1,l=[],b=[],v=null,B=!1;const T=()=>{const t="CINV-",n=Math.floor(1e5+Math.random()*9e5);return t+n};document.getElementById("invoice").value=T();const F=()=>{const t=S.value;let n="Search";switch(t){case"encoder-asc":case"encoder-desc":n="Search by Encoder";break;case"name-asc":case"name-desc":n="Search by Name";break;case"type-asc":case"type-desc":n="Search by Type";break;case"address-asc":case"address-desc":n="Search by Address";break;case"contactPerson-asc":case"contactPerson-desc":n="Search by Contact Person";break;case"number-asc":case"number-desc":n="Search by Number";break;case"email-asc":case"email-desc":n="Search by Email";break;case"valuation-asc":case"valuation-desc":n="Search by Valuation";break;case"status-asc":case"status-desc":n="Search by Status";break;case"donationDate-asc":case"donationDate-desc":n="Search by Donation Date";break;default:n="Search by Name, Encoder, Staff-In Charge"}x.placeholder=n};$.onAuthStateChanged(t=>{if(!t){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to access in-kind donations."}).then(()=>{window.location.href="../pages/login.html"});return}console.log("User authenticated:",t.uid),Y(t.uid),F()});function Y(t){h.ref("donations/monetary").on("value",n=>{l=[];const e=n.val();e&&Object.keys(e).forEach(o=>{const r=e[o];l.push({firebaseKey:o,userUid:r.userUid,...r})}),b=[...l],C()},n=>{console.error("Error fetching in-kind donations:",n),Swal.fire({icon:"error",title:"Error",text:"Failed to load in-kind donations: "+n.message})})}const D=t=>t.trim()==="",H=t=>/^[a-zA-Z\s]+$/.test(t),q=t=>/^\+?\d{7,15}$/.test(t.replace(/\s/g,"")),z=t=>/^\d+(\.\d{1,2})?$/.test(t),d=(t,n)=>{const e=t.nextElementSibling;if(!e||!e.classList.contains("error-message")){const o=document.createElement("div");o.className="error-message",t.parentNode.insertBefore(o,t.nextSibling),o.textContent=n}else e.textContent=n;t.classList.add("error")},L=t=>{const n=t.nextElementSibling;n&&n.classList.contains("error-message")&&(n.textContent=""),t.classList.remove("error")},j=()=>{let t=!0;return[{input:a.encoder,label:"Encoder",lettersOnly:!0},{input:a.name,label:"Name/Company",lettersOnly:!1},{input:a.address,label:"Location"},{input:a.number,label:"Number",telNumber:!0},{input:a.amount,label:"Amount Donated",numericAmount:!0,positiveNumber:!0},{input:a.invoice,label:"Cash Invoice #",required:!1},{input:a.dateReceived,label:"Date Received"},{input:a.email,label:"Email",isEmail:!0},{input:a.bank,label:"Bank"},{input:a.proof,label:"Proof of Transaction",required:!1}].forEach(({input:e,label:o,lettersOnly:r,telNumber:i,numericAmount:g,positiveNumber:u,isEmail:f,required:s=!0})=>{L(e),s&&D(e.value)?(d(e,`${o} is required.`),t=!1):D(e.value)||(r&&!H(e.value)&&(d(e,`${o} should only contain letters and spaces.`),t=!1),i&&!q(e.value)&&(d(e,`${o} should be a valid phone number.`),t=!1),g&&(z(e.value)?u&&parseFloat(e.value)<=0&&(d(e,`${o} must be a positive number.`),t=!1):(d(e,`${o} should only contain numbers.`),t=!1)),f&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())||(d(e,`Please enter a valid ${o.toLowerCase()} address.`),t=!1)))}),t};a.addEventListener("input",()=>{B=!0}),a.addEventListener("submit",t=>{if(t.preventDefault(),j()){const n=$.currentUser;if(!n){Swal.fire("Error","User not authenticated!","error");return}const e={encoder:a.encoder.value,name:a.name.value,address:a.address.value,number:a.number.value,amountDonated:parseFloat(a.amount.value),invoice:a.invoice.value,dateReceived:a.dateReceived.value,email:a.email.value,bank:a.bank.value,proof:a.proof.value,id:Date.now(),userUid:n.uid,createdAt:new Date().toISOString()};h.ref("donations/monetary").push(e).then(()=>{a.reset(),B=!1,Swal.fire({icon:"success",title:"Donation Added!",text:"Your donation has been successfully recorded.",timer:2e3,showConfirmButton:!1,background:"#e6f4ea",color:"#1b5e20",iconColor:"#2e7d32",customClass:{popup:"swal2-popup-success-clean",title:"swal2-title-success-clean",content:"swal2-text-success-clean"}})}).catch(o=>{console.error("Error adding donation:",o),Swal.fire({icon:"error",title:"Failed to Add Donation",text:"An error occurred: "+o.message,background:"#fcebea",color:"#b71c1c",iconColor:"#c62828",confirmButtonColor:"#c62828",customClass:{popup:"swal2-popup-error-clean",title:"swal2-title-error-clean",content:"swal2-text-error-clean"}})})}}),W.addEventListener("click",()=>{const t=()=>{a.encoder.value="",a.name.value="",a.address.value="",a.number.value="",a.amount.value="",a.dateReceived.value="",a.email.value="",a.bank.value="",a.proof.value="",document.getElementById("invoice").value=T(),B=!1,a.querySelectorAll(".error-message").forEach(o=>o.textContent=""),a.querySelectorAll(".error").forEach(o=>o.classList.remove("error"))};B?Swal.fire({title:"Discard Changes?",text:"You have unsaved changes. Are you sure you want to clear the form?",icon:"warning",iconColor:"#f57c00",showCancelButton:!0,confirmButtonColor:"#c62828",cancelButtonColor:"#546e7a",confirmButtonText:"Yes, clear it!",cancelButtonText:"No, keep editing",reverseButtons:!0,customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",content:"swal2-text-warning-clean",confirmButton:"swal2-button-confirm-clean",cancelButton:"swal2-button-cancel-clean"}}).then(n=>{n.isConfirmed&&t()}):t()});function C(){const t=(m-1)*w,n=t+w,e=b.slice(t,n);if(I.innerHTML="",e.length===0){const o=document.createElement("tr");o.innerHTML='<td colspan="12" style="text-align: center;">No donations found.</td>',I.appendChild(o)}else e.forEach((o,r)=>{const i=document.createElement("tr");i.innerHTML=`
                    <td>${t+r+1}</td>
                    <td>${o.encoder||"N/A"}</td>
                    <td>${o.name||"N/A"}</td>
                    <td>${o.address||"N/A"}</td>
                    <td>${o.number||"N/A"}</td>
                    <td>${parseFloat(o.amountDonated||0).toLocaleString("en-PH",{style:"currency",currency:"PHP"})}</td>
                    <td>${o.invoice||"N/A"}</td>
                    <td>${new Date(o.dateReceived).toLocaleDateString("en-PH")}</td>
                    <td>${o.email||"N/A"}</td>
                    <td>${o.bank||"N/A"}</td>
                    <td>${o.proof?`<a href="${o.proof}" target="_blank">View Proof</a>`:"N/A"}</td>
                    <td>
                        <button class="editBtn">Edit</button>
                        <button class="deleteBtn">Remove</button>
                        <button class="savePDFBtn">Save PDF</button>
                    </td>
                `,i.querySelector(".editBtn").addEventListener("click",()=>te(o.firebaseKey)),i.querySelector(".deleteBtn").addEventListener("click",()=>V(o.firebaseKey)),i.querySelector(".savePDFBtn").addEventListener("click",()=>J(o)),I.appendChild(i)});G(),Q()}function G(){const t=b.length,n=(m-1)*w+1,e=Math.min(m*w,t);R.textContent=`Showing ${n} to ${e} of ${t} entries`,t===0&&(R.textContent="Showing 0 to 0 of 0 entries")}const k=(t,n,e=!1,o=!1)=>{const r=document.createElement("button");return r.textContent=t,e&&(r.disabled=!0),o&&r.classList.add("active-page"),r.addEventListener("click",()=>{e||(m=n,C())}),r};function Q(){y.innerHTML="";const t=Math.ceil(b.length/w);if(t===0){y.innerHTML="<span>No entries to display</span>";return}y.appendChild(k("Prev",Math.max(1,m-1),m===1));const n=5;let e=Math.max(1,m-Math.floor(n/2)),o=Math.min(t,e+n-1);o-e<n-1&&(e=Math.max(1,o-n+1));for(let r=e;r<=o;r++)y.appendChild(k(r,r,!1,r===m));y.appendChild(k("Next",Math.min(t,m+1),m===t))}x.addEventListener("input",()=>{const t=x.value.toLowerCase(),n=S.value;b=l.filter(e=>n.includes("encoder")?(e.encoder||"").toLowerCase().includes(t):n.includes("name")?(e.name||"").toLowerCase().includes(t):n.includes("address")?(e.address||"").toLowerCase().includes(t):n.includes("number")?String(e.number||"").includes(t):n.includes("amount")?String(e.amountDonated||"").includes(t):n.includes("invoice")?(e.invoice||"").toLowerCase().includes(t):n.includes("dateReceived")?(e.dateReceived||"").toLowerCase().includes(t):n.includes("email")?(e.email||"").toLowerCase().includes(t):n.includes("bank")?(e.bank||"").toLowerCase().includes(t):(e.name||"").toLowerCase().includes(t)||(e.encoder||"").toLowerCase().includes(t)||(e.address||"").toLowerCase().includes(t)||(String(e.number)||"").includes(t)||(String(e.amountDonated)||"").includes(t)||(e.invoice||"").toLowerCase().includes(t)||(e.dateReceived||"").toLowerCase().includes(t)||(e.email||"").toLowerCase().includes(t)||(e.bank||"").toLowerCase().includes(t)),m=1,C()}),S.addEventListener("change",()=>{const t=S.value;Z(b,t),F(),C()});function Z(t,n){n==="encoder-asc"?t.sort((e,o)=>(e.encoder||"").localeCompare(o.encoder||"")):n==="encoder-desc"?t.sort((e,o)=>(o.encoder||"").localeCompare(e.encoder||"")):n==="name-asc"?t.sort((e,o)=>(e.name||"").localeCompare(o.name||"")):n==="name-desc"?t.sort((e,o)=>(o.name||"").localeCompare(e.name||"")):n==="address-asc"?t.sort((e,o)=>(e.address||"").localeCompare(o.address||"")):n==="address-desc"?t.sort((e,o)=>(o.address||"").localeCompare(e.address||"")):n==="number-asc"?t.sort((e,o)=>parseInt((e.number||"0").replace(/\D/g,""))-parseInt((o.number||"0").replace(/\D/g,""))):n==="number-desc"?t.sort((e,o)=>parseInt((o.number||"0").replace(/\D/g,""))-parseInt((e.number||"0").replace(/\D/g,""))):n==="amount-asc"?t.sort((e,o)=>(e.amountDonated||0)-(o.amountDonated||0)):n==="amount-desc"?t.sort((e,o)=>(o.amountDonated||0)-(e.amountDonated||0)):n==="invoice-asc"?t.sort((e,o)=>(e.invoice||"").localeCompare(o.invoice||"")):n==="invoice-desc"?t.sort((e,o)=>(o.invoice||"").localeCompare(e.invoice||"")):n==="dateReceived-asc"?t.sort((e,o)=>new Date(e.dateReceived||"0")-new Date(o.dateReceived||"0")):n==="dateReceived-desc"?t.sort((e,o)=>new Date(o.dateReceived||"0")-new Date(e.dateReceived||"0")):n==="email-asc"?t.sort((e,o)=>(e.email||"").localeCompare(o.email||"")):n==="email-desc"?t.sort((e,o)=>(o.email||"").localeCompare(e.email||"")):n==="bank-asc"?t.sort((e,o)=>(e.bank||"").localeCompare(o.bank||"")):n==="bank-desc"&&t.sort((e,o)=>(o.bank||"").localeCompare(e.bank||""))}U.addEventListener("click",()=>{if(l.length===0){Swal.fire("Info","No data to export!","info");return}const t=l.map((s,p)=>({"No.":p+1,Encoder:s.encoder,"Name/Company":s.name,Location:s.address,Number:s.number,"Amount Donated":s.amountDonated,"Cash Invoice #":s.invoice,"Date Received":new Date(s.dateReceived).toLocaleDateString("en-PH"),Email:s.email,Bank:s.bank,"Proof of Transaction":s.proof})),n=XLSX.utils.json_to_sheet(t),e=XLSX.utils.book_new();XLSX.utils.book_append_sheet(e,n,"Monetary Donations");const o=new Date,r=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),g=String(o.getDate()).padStart(2,"0"),f=`monetary-donations_${`${r}-${i}-${g}`}.xlsx`;XLSX.writeFile(e,f),Swal.fire("Success",`Monetary Donations exported to ${f}!`,"success")}),K.addEventListener("click",()=>{if(l.length===0){Swal.fire("Info","No data to export to PDF!","info");return}const{jsPDF:t}=window.jspdf,n=new t("landscape");let e=20;const o=new Image;o.src="../assets/images/AB_logo.png",o.onload=function(){const r=n.internal.pageSize.width,i=30,g=o.naturalHeight/o.naturalWidth*i,u=14;n.addImage(o,"PNG",r-i-u,u,i,g),n.setFontSize(18),n.text("Monetary Donations Report",14,e),e+=10,n.setFontSize(10),n.text(`Report Generated: ${new Date().toLocaleString()}`,14,e),e+=15;const f=[["No.","Encoder","Name/Company","Location","Number","Amount Donated","Cash Invoice #","Date Received","Email","Bank"]],s=l.map((c,E)=>[E+1,c.encoder||"N/A",c.name||"N/A",c.address||"N/A",String(c.number)||"N/A",`PHP ${parseFloat(c.amountDonated||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`,c.invoice||"N/A",new Date(c.dateReceived).toLocaleDateString("en-PH")||"N/A",c.email||"N/A",c.bank||"N/A"]);n.autoTable({head:f,body:s,startY:e,theme:"grid",headStyles:{fillColor:[20,174,187],textColor:[255,255,255],halign:"center"},styles:{fontSize:8,cellPadding:2},didDrawPage:function(c){n.setFontSize(8);const E=`Page ${c.pageNumber} of ${n.internal.getNumberOfPages()}`,A="Powered by: Appvance",N=n.internal.pageSize.width,O=c.settings.margin.left,_=n.internal.pageSize.height-10;n.text(E,O,_),n.text(A,N-O,_,{align:"right"})}});const p=`all-monetary-donations_${new Date().toISOString().slice(0,10)}.pdf`;n.save(p),Swal.close(),Swal.fire("Success",`All Monetary Donations exported to "${p}"`,"success")},o.onerror=function(){Swal.fire("Error","Failed to load logo image. Please check the path.","error")}});function J(t){const{jsPDF:n}=window.jspdf,e=new n,o=new Image;o.src="../assets/images/AB_logo.png",o.onload=function(){const r=e.internal.pageSize.width,i=30,g=o.naturalHeight/o.naturalWidth*i,u=14;e.addImage(o,"PNG",r-i-u,u,i,g),e.setFontSize(18),e.text("Monetary Donation Details",14,22),e.setFontSize(10),e.text(`Report Generated: ${new Date().toLocaleString()}`,14,30);let f=45;const s=(A,N)=>{e.text(`${A}: ${N||"N/A"}`,14,f),f+=7};s("Encoder",t.encoder),s("Name/Company",t.name),s("Location",t.address),s("Number",String(t.number)),s("Amount Donated",`PHP ${parseFloat(t.amountDonated||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`),s("Cash Invoice #",t.invoice),s("Date Received",new Date(t.dateReceived).toLocaleDateString("en-PH")),s("Email",t.email),s("Bank",t.bank),s("Proof of Transaction",t.proof),s("Recorded On",new Date(t.createdAt).toLocaleString()),e.setFontSize(8);const p=e.internal.pageSize.height-10,c="Page 1 of 1",E="Powered by: Appvance";e.text(c,u,p),e.text(E,r-u,p,{align:"right"}),e.save(`monetary_donation_${new Date().toISOString().slice(0,10)}.pdf`),Swal.fire({title:"Export Successful!",text:"Monetary donation details have been exported to PDF.",icon:"success",color:"#1b5e20",iconColor:"#43a047",confirmButtonColor:"#388e3c",confirmButtonText:"Great!",customClass:{popup:"swal2-popup-success-export",title:"swal2-title-success-export",content:"swal2-text-success-export",confirmButton:"swal2-button-success-export"}})},o.onerror=function(){Swal.fire("Error","Failed to load logo image. Please check the path.","error")}}function V(t){Swal.fire({title:"Are you sure?",text:"This monetary donation entry will be deleted from the list but saved to deleted donations!",icon:"warning",iconColor:"#ffa000",showCancelButton:!0,confirmButtonColor:"#d32f2f",cancelButtonColor:"#546e7a",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0,customClass:{popup:"swal2-popup-delete-clean",title:"swal2-title-delete-clean",content:"swal2-text-delete-clean",confirmButton:"swal2-button-confirm-clean",cancelButton:"swal2-button-cancel-clean"}}).then(n=>{if(n.isConfirmed){const e=l.find(r=>r.firebaseKey===t);if(!e){Swal.fire("Error","Donation not found!","error");return}const o={...e,deletedAt:new Date().toISOString()};h.ref(`deleteddonations/deletedmonetary/${t}`).set(o).then(()=>h.ref(`donations/monetary/${t}`).remove()).then(()=>{Swal.fire("Deleted!","The donation entry has been moved to deleted donations.","success")}).catch(r=>{console.error("Error moving donation to deleted donations:",r),Swal.fire("Error","Failed to delete donation: "+r.message,"error")})}})}const ee=()=>{let t=!0;return[{input:document.getElementById("edit-encoder"),label:"Encoder",lettersOnly:!0},{input:document.getElementById("edit-name"),label:"Name/Company",lettersOnly:!1},{input:document.getElementById("edit-address"),label:"Location"},{input:document.getElementById("edit-number"),label:"Number",telNumber:!0},{input:document.getElementById("edit-amount"),label:"Amount Donated",numericAmount:!0,positiveNumber:!0},{input:document.getElementById("edit-invoice"),label:"Cash Invoice #",required:!1},{input:document.getElementById("edit-dateReceived"),label:"Date Received"},{input:document.getElementById("edit-email"),label:"Email",isEmail:!0},{input:document.getElementById("edit-bank"),label:"Bank"},{input:document.getElementById("edit-proof"),label:"Proof of Transaction",required:!1}].forEach(({input:e,label:o,lettersOnly:r,telNumber:i,numericAmount:g,positiveNumber:u,isEmail:f,required:s=!0})=>{L(e),s&&D(e.value)?(d(e,`${o} is required.`),t=!1):D(e.value)||(r&&!H(e.value)&&(d(e,`${o} should only contain letters and spaces.`),t=!1),i&&!q(e.value)&&(d(e,`${o} should be a valid phone number.`),t=!1),g&&(z(e.value)?u&&parseFloat(e.value)<=0&&(d(e,`${o} must be a positive number.`),t=!1):(d(e,`${o} should only contain numbers.`),t=!1)),f&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())||(d(e,`Please enter a valid ${o.toLowerCase()} address.`),t=!1)))}),t};function te(t){v=t;const n=l.find(e=>e.firebaseKey===t);n&&(document.getElementById("edit-encoder").value=n.encoder||"",document.getElementById("edit-name").value=n.name||"",document.getElementById("edit-address").value=n.address||"",document.getElementById("edit-number").value=n.number||"",document.getElementById("edit-amount").value=n.amountDonated,document.getElementById("edit-invoice").value=n.invoice||"",document.getElementById("edit-dateReceived").value=n.dateReceived||"",document.getElementById("edit-email").value=n.email||"",document.getElementById("edit-bank").value=n.bank||"",document.getElementById("edit-proof").value=n.proof||"",M.style.display="block",Array.from(M.querySelectorAll("input, select")).forEach(L))}document.getElementById("saveEditBtn").addEventListener("click",()=>{if(v!==null&&ee()){const t={encoder:document.getElementById("edit-encoder").value,name:document.getElementById("edit-name").value,address:document.getElementById("edit-address").value,number:document.getElementById("edit-number").value,amountDonated:parseFloat(document.getElementById("edit-amount").value),invoice:document.getElementById("edit-invoice").value,dateReceived:document.getElementById("edit-dateReceived").value,email:document.getElementById("edit-email").value,bank:document.getElementById("edit-bank").value,proof:document.getElementById("edit-proof").value,id:l.find(n=>n.firebaseKey===v).id,userUid:l.find(n=>n.firebaseKey===v).userUid,createdAt:l.find(n=>n.firebaseKey===v).createdAt,updatedAt:new Date().toISOString()};h.ref(`donations/monetary/${v}`).update(t).then(()=>{P(),Swal.fire({title:"Success!",text:"Donation updated successfully!",icon:"success",color:"#1b5e20",iconColor:"#43a047",confirmButtonColor:"#388e3c",confirmButtonText:"OK",customClass:{popup:"swal2-popup-success-clean",title:"swal2-title-success-clean",content:"swal2-text-success-clean",confirmButton:"swal2-button-success-clean"}}),v=null}).catch(n=>{console.error("Error updating donation:",n),Swal.fire("Error","Failed to update donation: "+n.message,"error")})}});function P(){const t=document.getElementById("editModal");t.style.display="none",v=null,t.querySelectorAll(".error-message").forEach(o=>o.textContent=""),t.querySelectorAll(".error").forEach(o=>o.classList.remove("error"))}document.getElementById("closeEditModalBtn").addEventListener("click",P),document.getElementById("cancelEditBtn").addEventListener("click",P)});
