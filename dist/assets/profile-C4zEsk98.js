import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                *//* empty css               */import"https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";import{i as ne,g as se,a as re,o as ae,u as j,r as b,b as F,E as ie,c as le,d as ce}from"./index.esm2017-CKqBSwm5.js";const de={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"},ee=ne(de),Y=se(ee),A=re(ee);document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("group-title"),p=document.getElementById("group-description"),H=document.getElementById("profile-position"),N=document.getElementById("profile-org-name"),I=document.getElementById("profile-hq"),f=document.getElementById("profile-contact-person"),h=document.getElementById("profile-email"),w=document.getElementById("profile-mobile"),x=document.getElementById("profile-area"),P=document.getElementById("org-name-field"),B=document.getElementById("hq-field"),L=document.getElementById("area-field"),k=document.getElementById("termsAndConditionsModal"),v=document.getElementById("agreeCheckbox"),C=document.getElementById("agreeButton"),te=document.querySelectorAll(".sidebar a, .header a"),J=1,c=document.getElementById("basic-info-section"),d=document.querySelector(".form-container-2"),Q=document.getElementById("new-password"),S=document.getElementById("password-strength-message"),T=document.querySelector(".strength-bar"),z=document.querySelector(".strength-bar-container"),U=document.getElementById("password-tooltip"),W=document.getElementById("check-length"),Z=document.getElementById("check-uppercase"),$=document.getElementById("check-number"),K=document.getElementById("check-symbol");let y=!1;const l=(e,o,s=!1)=>{Swal.fire({icon:"error",title:e,text:o}).then(()=>{s&&window.location.replace("../pages/login.html")})},D=()=>{console.log("Setting profile fields to N/A due to data fetch failure or irrelevance."),m&&(m.textContent="Group Information Unavailable"),p&&(p.textContent="Unable to fetch group details."),N&&(N.textContent="N/A"),I&&(I.textContent="N/A"),f&&(f.textContent="N/A"),h&&(h.textContent="N/A"),w&&(w.textContent="N/A"),x&&(x.textContent="N/A")},oe=async e=>{const o=localStorage.getItem("userEmail");if(console.log("Fetching data for user email:",o),!o){console.error("No userEmail found in localStorage."),l("Not Logged In","No user email found. Please log in again.",!0);return}try{const s=await F(b(A,"users/"+e.uid));if(console.log("Users snapshot:",s.val()),!s.exists()){console.error("No user found with UID:",e.uid),l("User Not Found","User data not found in the database. Please contact support."),D();return}let n=s.val();if(console.log("User data retrieved:",n),H&&(H.innerText=n.role||"N/A"),n.role==="AB ADMIN"){console.log("User is AB ADMIN. Adjusting display."),f&&(f.innerText=n.contactPerson||"N/A"),h&&(h.innerText=n.email||"N/A"),w&&(w.innerText=n.mobile||"N/A"),m&&(m.textContent="Admin Account"),p&&(p.textContent="This is an administrative account. Group-specific information is not applicable."),P&&(P.style.display="none"),B&&(B.style.display="none"),L&&(L.style.display="none");return}if(P&&(P.style.display="flex"),B&&(B.style.display="flex"),L&&(L.style.display="flex"),!n.organization){console.error("No organization found for user:",e.uid),l("Organization Not Found","Organization data not found for this user. Please contact support."),D();return}console.log("Querying volunteerGroups node for organization:",n.organization);const r=await F(b(A,"volunteerGroups"));let t=null,i=null;if(r.exists()&&r.forEach(a=>{if(a.val().organization===n.organization)return i=a.key,t=a.val(),!0}),console.log("Volunteer group snapshot:",r.val()),!t){console.error("No group found for organization:",n.organization),l("Group Data Not Found","Volunteer group data not found. Please contact support."),D();return}console.log("Volunteer group data retrieved:",t),m&&(m.textContent=`Volunteer Group: ${t.organization||"N/A"}`),p&&(p.textContent=`You are logged in as part of the ${t.organization||"N/A"} group.`),N&&(N.textContent=t.organization||"N/A"),I&&(I.textContent=t.hq||"N/A"),f&&(f.textContent=t.contactPerson||"N/A"),h&&(h.textContent=t.email||"N/A"),w&&(w.textContent=t.mobileNumber||n.mobile||"N/A"),x&&(x.textContent=t.areaOfOperation||"N/A"),localStorage.setItem("loggedInVolunteerGroup",JSON.stringify({no:i,organization:t.organization,hq:t.hq,areaOfOperation:t.areaOfOperation,contactPerson:t.contactPerson,email:t.email,mobileNumber:t.mobileNumber||n.mobile,socialMedia:t.socialMedia||""}))}catch(s){console.error("Error fetching user or group data:",s),l("Error","Failed to fetch data: "+s.message),D()}};function X(){k&&(k.classList.remove("hidden"),document.body.classList.add("modal-open"),C.disabled=!0,v.checked=!1,y=!0,q(),history.pushState(null,null,location.href),window.removeEventListener("popstate",_),window.addEventListener("popstate",_),c&&(c.style.display="none"),d&&(d.style.display="none"))}function O(){k&&(k.classList.add("hidden"),document.body.classList.remove("modal-open"),y=!1,q(),window.removeEventListener("popstate",_))}function q(){te.forEach(e=>{y?(e.dataset.originalHref||(e.dataset.originalHref=e.href),e.href="#",e.removeEventListener("click",M),e.addEventListener("click",M)):(e.dataset.originalHref&&(e.href=e.dataset.originalHref),e.removeEventListener("click",M))})}function M(e){e.preventDefault(),y&&Swal.fire({icon:"warning",title:"Action Required",text:"You must complete the required actions to navigate the application."})}function _(e){history.pushState(null,null,location.href)}ae(Y,async e=>{if(e){console.log("User is authenticated:",e.uid),await oe(e);try{const s=(await F(b(A,"users/"+e.uid))).val(),n=s&&s.terms_agreed_version||0,r=s&&s.password_needs_reset||!1,t=JSON.parse(localStorage.getItem("userData")),i=t?t.isFirstLogin===!0:!1,a=t?t.termsAccepted===!0:!1;n<J||i&&!a?(console.log("Showing terms modal: termsPending=true"),X()):r?(console.log("Password change required: passwordNeedsReset=true"),O(),y=!0,q(),c&&(c.style.display="none"),d&&(d.style.display="block"),sessionStorage.getItem("passwordChangePromptShown")||(Swal.fire({icon:"info",title:"Password Change Required",text:"For security reasons, please change your password.",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,confirmButtonText:"Understood"}),sessionStorage.setItem("passwordChangePromptShown","true"))):(console.log("No action required: full profile visible"),O(),y=!1,q(),c&&(c.style.display="block"),d&&(d.style.display="block"),sessionStorage.removeItem("passwordChangePromptShown"))}catch(o){console.error("Error fetching user terms agreement or password reset status:",o),Swal.fire({icon:"warning",title:"Agreement/Password Check Failed",text:"Could not verify your account status. Please review and agree to terms or change password if prompted."}).then(()=>{X()})}}else console.error("No user is authenticated. Redirecting to login."),l("Not Logged In","Please log in to view your profile.",!0)}),v&&v.addEventListener("change",()=>{C&&(C.disabled=!v.checked)}),C&&C.addEventListener("click",async()=>{if(v.checked){const e=Y.currentUser;if(e)try{const o=JSON.parse(localStorage.getItem("userData")),s=o?o.isFirstLogin===!0:!1;await j(b(A,"users/"+e.uid),{terms_agreed_version:J,terms_agreed_at:new Date().toISOString(),isFirstLogin:!1,termsAccepted:!0}),o&&(o.isFirstLogin=!1,o.termsAccepted=!0,localStorage.setItem("userData",JSON.stringify(o)));const r=(await F(b(A,"users/"+e.uid))).val(),t=r&&r.password_needs_reset||!1;if(O(),t)await Swal.fire({icon:"success",title:"Agreement Accepted & Password Change Required!",text:"Thank you for accepting the Terms and Conditions. For security reasons, please proceed to change your temporary password now.",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,confirmButtonText:"Continue to Password Change"}),c&&(c.style.display="none"),d&&(d.style.display="block"),window.location.replace("../pages/profile.html");else{await Swal.fire({icon:"success",title:"Agreement Accepted!",text:"Thank you for accepting the Terms and Conditions.",timer:2e3,showConfirmButton:!1});const i=localStorage.getItem("userRole");let a="../pages/dashboard.html";s&&(i==="ABVN"||i==="volunteer")&&(a="../pages/profile.html"),window.location.replace(a)}}catch(o){console.error("Error updating terms agreement:",o),l("Oops...","Failed to record your agreement. Please try again.")}else l("Authentication Error","User not logged in. Please refresh and try again.",!0)}});const V=e=>{const o=document.getElementById(e),s=o?o.parentElement:null,n=s?s.querySelector(".password-toggle-closed"):null,r=s?s.querySelector(".password-toggle-open"):null;n&&r&&o&&s?(r.style.display="none",n.style.display="inline",n.addEventListener("click",()=>{o.type="text",s.classList.add("show-open-lock")}),r.addEventListener("click",()=>{o.type="password",s.classList.remove("show-open-lock")})):console.warn(`Password toggle icons or input not found for ${e}`)};V("current-password"),V("new-password"),V("confirm-new-password");const G=document.querySelector("form");G&&G.addEventListener("submit",async e=>{e.preventDefault();const o=Y.currentUser;if(!o){console.error("No user is signed in."),l("Not Logged In","Please log in to change your password.",!0);return}const s=document.getElementById("current-password").value,n=document.getElementById("new-password").value,r=document.getElementById("confirm-new-password").value;if(n!==r){Swal.fire({icon:"error",title:"Password Mismatch",text:"New password and confirmation do not match."});return}if(n===s){Swal.fire({icon:"error",title:"Same Password",text:"Your new password cannot be the same as your current password."});return}const t=n.length>=8,i=/[A-Z]/.test(n),a=/[0-9]/.test(n),u=/[^A-Za-z0-9]/.test(n);if(!t||!i||!a||!u){Swal.fire({icon:"error",title:"Weak Password",text:"Your new password does not meet the complexity requirements. Please ensure it has at least 8 characters, one uppercase letter, one number, and one symbol."});return}const g=o.email;if(!g){l("Error","No email associated with this user for re-authentication.");return}try{const E=ie.credential(g,s);await le(o,E),await ce(o,n),await j(b(A,`users/${o.uid}`),{lastPasswordChange:new Date().toISOString(),password_needs_reset:!1}),Swal.fire({icon:"success",title:"Password Changed",text:"Your password has been updated successfully. You can now access your full profile.",timer:3e3,showConfirmButton:!1}).then(()=>{G.reset(),sessionStorage.removeItem("passwordChangePromptShown"),window.location.replace("../pages/profile.html")})}catch(E){console.error("Password change error:",E);let R="Failed to change password. Please ensure your current password is correct.";E.code==="auth/invalid-credential"||E.code==="auth/wrong-password"?R="Incorrect current password or authentication issue.":E.code==="auth/requires-recent-login"&&(R="For security, please log in again before changing your password."),l("Error",R)}}),Q&&S&&T&&z&&U&&W&&Z&&$&&K?Q.addEventListener("input",function(){const e=this.value.trim();if(e.length===0){U.classList.remove("show"),S.classList.remove("show"),z.classList.remove("show");return}U.classList.add("show"),S.classList.add("show"),z.classList.add("show");const o=e.length>=8,s=/[A-Z]/.test(e),n=/[0-9]/.test(e),r=/[^A-Za-z0-9]/.test(e);W.textContent=(o?"✅":"❌")+" At least 8 characters",Z.textContent=(s?"✅":"❌")+" An uppercase letter",$.textContent=(n?"✅":"❌")+" A number",K.textContent=(r?"✅":"❌")+" A symbol (!@#$ etc.)";let t="",i="",a="0%",u="red";const g=[o,s,n,r].filter(Boolean).length;g<=1?(t="Weak",i="strength-weak",a="25%",u="red"):g===2?(t="Medium",i="strength-medium",a="50%",u="orange"):g===3?(t="Good",i="strength-good",a="75%",u="yellowgreen"):g===4&&(t="Strong",i="strength-strong",a="100%",u="green"),S.textContent="Strength: "+t,S.className="strength-message "+i,T.style.width=a,T.style.backgroundColor=u}):console.warn("Password strength indicator elements not found. Skipping password strength logic.")});
