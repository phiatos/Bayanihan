import"./global-Dd8t204S.js";/* empty css                */document.addEventListener("DOMContentLoaded",()=>{const X={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};firebase.initializeApp(X);const Y=firebase.database(),x=firebase.auth();let i={},u=[],p=[],h="",y=[],b="",v="",B="",E="",w="";const J=document.getElementById("submittedReportsContainer"),ee=document.getElementById("pagination"),te=document.getElementById("entriesInfo"),N=document.getElementById("searchInput"),C=document.getElementById("sortSelect");function f(l){return l.replace(/[.#$/[\]]/g,"_").replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"")}x.onAuthStateChanged(l=>{if(!l){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to access RDANA reports."}).then(()=>{window.location.href="../pages/login.html"});return}console.log("User authenticated:",l.uid),J&&ee&&te&&N&&C&&loadSubmittedReports(l.uid)});function S(l){const g=document.querySelectorAll(`${l} input[required], ${l} select[required], ${l} textarea[required]`);let m=!0;return g.forEach(a=>{const r=a.nextElementSibling;a.value.trim()?(a.classList.remove("input-error"),r&&r.classList.contains("error-message")&&(r.style.display="none")):(m=!1,a.classList.add("input-error"),r&&r.classList.contains("error-message")&&(r.textContent="This field is required.",r.style.display="block"))}),m}document.querySelectorAll('input[type="text"]').forEach(l=>{l.addEventListener("input",function(){this.value=this.value.charAt(0).toUpperCase()+this.value.slice(1),(this.placeholder.includes("Name")||this.placeholder.includes("Organization"))&&(this.value=this.value.replace(/[^a-zA-Z\s]/g,"")),this.placeholder.includes("Barangay")&&(this.value=this.value.replace(/[^a-zA-Z0-9\s]/g,"")),this.type==="number"&&this.value<0&&(this.value="")})});const q=document.getElementById("nextBtn4");q&&q.addEventListener("click",()=>{var M,F,z,O,Q,W;if(!S("#form-page-4")){Swal.fire({icon:"warning",title:"Incomplete Data",text:"Please fill in all required fields on this page.",background:"#fffaf0",color:"#92400e",iconColor:"#f59e0b",confirmButtonColor:"#d97706",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",content:"swal2-text-warning-clean"}});return}const l=document.getElementById("preview-data");l.innerHTML="";const g=document.querySelectorAll("#form-page-1 input, #form-page-1 select");let m="<h3>Profile of the Disaster</h3><div class='table-scroll'><table class='preview-table' id='page1preview'>";i={},g.forEach(t=>{const e=t.previousElementSibling?t.previousElementSibling.innerText:"Field",o=f(e);m+=`<tr><td id='page1-tdlabel'>${e}</td><td id='page1-tdinput'>${t.value}</td></tr>`,i[o]=t.value}),m+="</table></div>";function a(t){let e=BigInt(t||"0");const o=1000000000000n,c=1000000000n,d=1000000n,n=1000n;return e>=o?(Number(e)/Number(o)).toFixed(2).replace(/\.?0+$/,"")+"T":e>=c?(Number(e)/Number(c)).toFixed(2).replace(/\.?0+$/,"")+"B":e>=d?(Number(e)/Number(d)).toFixed(2).replace(/\.?0+$/,"")+"M":e>=n?(Number(e)/Number(n)).toFixed(2).replace(/\.?0+$/,"")+"k":e.toString()}h=((M=document.querySelector("#form-page-2 textarea"))==null?void 0:M.value)||"";let r=`<h3>Summary of Disaster/Incident</h3><p>${h}</p>`;const ne=document.querySelectorAll("#disasterprofile-table tbody tr");r+="<div class='table-scroll'><table class='preview-table' id='page2preview'><tr><th>Community</th><th>Total Pop.</th><th>Affected Pop.</th><th>Deaths</th><th>Injured</th><th>Missing</th><th>Children</th><th>Women</th><th>Seniors</th><th>PWD</th></tr>",u=[],ne.forEach(t=>{var c,d,n,s,j,V,G,U,H,Z;const e=t.querySelectorAll("input")||[];r+="<tr>";const o={community:((c=e[0])==null?void 0:c.value)||"",totalPop:a((d=e[1])==null?void 0:d.value)||"0",affected:a((n=e[2])==null?void 0:n.value)||"0",deaths:a((s=e[3])==null?void 0:s.value)||"0",injured:a((j=e[4])==null?void 0:j.value)||"0",missing:a((V=e[5])==null?void 0:V.value)||"0",children:a((G=e[6])==null?void 0:G.value)||"0",women:a((U=e[7])==null?void 0:U.value)||"0",seniors:a((H=e[8])==null?void 0:H.value)||"0",pwd:a((Z=e[9])==null?void 0:Z.value)||"0"};u.push(o),e.forEach((K,ae)=>{ae===0?r+=`<td>${K.value}</td>`:r+=`<td>${a(K.value)}</td>`}),r+="</tr>"}),r+="</table></div>";const oe=document.querySelectorAll("#status-table tbody tr");let k="<h3>Status of Structures</h3><div class='table-scroll'><table class='preview-table' id='page3preview'><tr><th>Structure</th><th>Status</th></tr>";y=[],oe.forEach(t=>{var n;const e=((n=t.querySelector("td"))==null?void 0:n.innerText)||"";let o="N/A";const c=t.querySelector("select"),d=t.querySelector("input");if(c){const s=c.selectedOptions[0];o=s&&s.value?s.text:"N/A"}else d&&(o=d.value.trim()||"N/A");k+=`<tr><td>${e}</td><td>${o}</td></tr>`,y.push({structure:e,status:o})}),k+="</table></div>";const le=document.querySelectorAll("#checklist-table input[type='checkbox']");let A="<h3>Initial Needs Assessment</h3><div class='table-scroll'><table class='preview-table' id='page4preview'><tr><th>Item</th><th>Needed</th></tr>";p=[],le.forEach(t=>{var o;const e=((o=t.closest("tr").querySelector("td"))==null?void 0:o.innerText)||"";A+=`<tr><td>${e}</td><td>${t.checked?"Yes":"No"}</td></tr>`,p.push({item:e,needed:t.checked})}),A+="</table></div>",b=((F=document.querySelector("#form-page-4 input[placeholder='Enter items']"))==null?void 0:F.value)||"N/A",v=((z=document.querySelector("#form-page-4 input[placeholder='Estimated No. of Families to Benefit']"))==null?void 0:z.value)||"N/A",B=((O=document.querySelector("#form-page-4 input[placeholder='Enter Name of Organization/s']"))==null?void 0:O.value)||"N/A",E=((Q=document.querySelector("#form-page-4 input[placeholder='Enter Relief Assistance']"))==null?void 0:Q.value)||"N/A",w=((W=document.querySelector("#form-page-4 input[placeholder='Enter number of families']"))==null?void 0:W.value)||"N/A",A+=`
        <p><strong>Other Immediate Needs:</strong> ${b}</p>
        <p><strong>Estimated Quantity:</strong> ${v}</p>
        <h3 style="margin-top: 15px; margin-bottom: 10px;">Initial Response Actions</h3>
        <p><strong>Response Groups Involved:</strong> ${B}</p>
        <p><strong>Relief Assistance Deployed:</strong> ${E}</p>
        <p><strong>Number of Families Served:</strong> ${w}</p>
      `,l.innerHTML=m+r+k+A,document.getElementById("form-page-4").style.display="none",document.getElementById("form-page-5").style.display="block";const I=document.getElementById("submitReportBtn");if(I){const t=I.cloneNode(!0);I.parentNode.replaceChild(t,I),t.addEventListener("click",e=>{e.preventDefault(),t.disabled=!0,t.textContent="Submitting...",console.log("Submit button clicked at:",new Date().toISOString()),x.onAuthStateChanged(o=>{if(console.log("Auth state checked:",o?o.uid:"No user"),!o){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to submit a report."}).then(()=>{window.location.href="../pages/login.html"}),t.disabled=!1,t.textContent="Submit Report";return}if(console.log("User authenticated for submission:",o.uid),console.log("Form data before validation:",{profileData:i,affectedCommunities:u,needsChecklist:p}),!i||Object.keys(i).length===0||!u||u.length===0||!p||p.length===0){console.error("Form data is incomplete:",{profileData:i,affectedCommunities:u,needsChecklist:p}),Swal.fire({icon:"error",title:"Submission Failed",text:"Form data is incomplete. Please ensure all fields are filled correctly.",background:"#fef2f2",color:"#7f1d1d",iconColor:"#b91c1c",confirmButtonColor:"#991b1b",customClass:{popup:"swal2-popup-error-clean",title:"swal2-title-error-clean",content:"swal2-text-error-clean"}}),t.disabled=!1,t.textContent="Submit Report";return}const c={rdanaId:`RDANA-${Math.floor(100+Math.random()*900)}`,dateTime:new Date().toISOString(),siteLocation:i[f("Site Location/Address (Barangay)")]||"N/A",disasterType:i[f("Type of Disaster")]||"N/A",effects:{affectedPopulation:u.reduce((n,s)=>n+s.affected,0)},needs:{priority:p.filter(n=>n.needed).map(n=>n.item)},profile:i,modality:{Locations_and_Areas_Affected:i[f("Locations and Areas Affected (Barangay)")]||"N/A",Type_of_Disaster:i[f("Type of Disaster")]||"N/A",Date_and_Time_of_Occurrence:i[f("Date of Occurrence")]+" "+i[f("Time of Occurrence")]||"N/A"},summary:h,affectedCommunities:u,structureStatus:y,needsChecklist:p,otherNeeds:b,estQty:v,responseGroup:B,reliefDeployed:E,familiesServed:w,userUid:o.uid,status:"Submitted",timestamp:firebase.database.ServerValue.TIMESTAMP};console.log("Attempting to save RDANA report:",c);const d=Y.ref("rdana/submitted");console.log("Database reference created:",d.toString()),d.push(c).then(()=>{console.log("RDANA report saved successfully to rdana/submitted"),Swal.fire({icon:"success",title:"Report Submitted",text:"Your RDANA report has been submitted for verification!",background:"#e6ffed",color:"#065f46",iconColor:"#10b981",confirmButtonColor:"#059669",timer:2e3,showConfirmButton:!1,customClass:{popup:"swal2-popup-success-clean",title:"swal2-title-success-clean",content:"swal2-text-success-clean"}}).then(()=>{i={},u=[],p=[],h="",y=[],b="",v="",B="",E="",w="",document.querySelectorAll("input, textarea, select").forEach(s=>{s.type==="checkbox"?s.checked=!1:s.value=""});const n=document.getElementById("tableBody");n&&(n.innerHTML=`
                      <tr>
                        <td><input type="text" placeholder="Enter Municipalities/Communities" required/></td>
                        <td><input type="number" placeholder="Enter Total Population" min="0" required/></td>
                        <td><input type="number" placeholder="Enter Affected Population" min="0" required/></td>
                        <td><input type="number" placeholder="No. of Deaths" min="0" required/></td>
                        <td><input type="number" placeholder="No. of Injured" min="0" required/></td>
                        <td><input type="number" placeholder="No. of Missing" min="0" required/></td>
                        <td><input type="number" placeholder="No. of Children" min="0" required/></td>
                        <td><input type="number" placeholder="No. of Women" min="0" required/></td>
                        <td><input type="number" placeholder="No. of Senior Citizens" min="0" required/></td>
                        <td><input type="number" placeholder="No. of PWD" min="0" required/></td>
                        <td><button type="reset" class="removeRowBtn">Clear</button></td>
                      </tr>
                    `),document.getElementById("form-page-5").style.display="none",document.getElementById("form-page-1").style.display="block"})}).catch(n=>{console.error("Error saving RDANA report to Firebase:",n),console.error("Error code:",n.code),console.error("Error message:",n.message),Swal.fire({icon:"error",title:"Submission Failed",text:"Failed to submit RDANA report: "+n.message,background:"#fdecea",color:"#b91c1c",iconColor:"#dc2626",confirmButtonColor:"#b91c1c",timer:3e3,showConfirmButton:!0,customClass:{popup:"swal2-popup-error-clean",title:"swal2-title-error-clean",content:"swal2-text-error-clean"}})}).finally(()=>{t.disabled=!1,t.textContent="Submit Report"})})})}}),N&&C&&(N.addEventListener("input",applySearchAndSort),C.addEventListener("change",applySearchAndSort));const D=document.getElementById("nextBtn1"),L=document.getElementById("nextBtn2"),R=document.getElementById("nextBtn3"),T=document.getElementById("backBtn2"),_=document.getElementById("backBtn3"),$=document.getElementById("backBtn4"),P=document.getElementById("backBtn5");D&&D.addEventListener("click",()=>{S("#form-page-1")?(document.getElementById("form-page-1").style.display="none",document.getElementById("form-page-2").style.display="block"):Swal.fire({icon:"warning",title:"Incomplete Data",text:"Please fill in all required fields on this page.",background:"#fffaf0",color:"#92400e",iconColor:"#f59e0b",confirmButtonColor:"#d97706",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",content:"swal2-text-warning-clean"}})}),L&&L.addEventListener("click",()=>{S("#form-page-2")?(document.getElementById("form-page-2").style.display="none",document.getElementById("form-page-3").style.display="block"):Swal.fire({icon:"warning",title:"Incomplete Data",text:"Please fill in all required fields on this page.",background:"#fffaf0",color:"#92400e",iconColor:"#f59e0b",confirmButtonColor:"#d97706",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",content:"swal2-text-warning-clean"}})}),R&&R.addEventListener("click",()=>{S("#form-page-3")?(document.getElementById("form-page-3").style.display="none",document.getElementById("form-page-4").style.display="block"):Swal.fire({icon:"warning",title:"Incomplete Data",text:"Please fill in all required fields on this page.",background:"#fffaf0",color:"#92400e",iconColor:"#f59e0b",confirmButtonColor:"#d97706",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",content:"swal2-text-warning-clean"}})}),T&&T.addEventListener("click",()=>{document.getElementById("form-page-2").style.display="none",document.getElementById("form-page-1").style.display="block"}),_&&_.addEventListener("click",()=>{document.getElementById("form-page-3").style.display="none",document.getElementById("form-page-2").style.display="block"}),$&&$.addEventListener("click",()=>{document.getElementById("form-page-4").style.display="none",document.getElementById("form-page-3").style.display="block"}),P&&P.addEventListener("click",()=>{document.getElementById("form-page-5").style.display="none",document.getElementById("form-page-4").style.display="block"}),document.getElementById("addRowBtn").addEventListener("click",function(){const l=document.getElementById("tableBody"),g=document.createElement("tr");g.innerHTML=`
      <td><input type="text" placeholder="Enter Municipalities/Communities" /></td>
      <td><input type="number" placeholder="Enter Total Population" /></td>
      <td><input type="number" placeholder="Enter Affected Population" /></td>
      <td><input type="number" placeholder="No. of Deaths" /></td>
      <td><input type="number" placeholder="No. of Injured" /></td>
      <td><input type="number" placeholder="No. of Missing" /></td>
      <td><input type="number" placeholder="No. of Children" /></td>
      <td><input type="number" placeholder="No. of Women" /></td>
      <td><input type="number" placeholder="No. of Senior Citizens" /></td>
      <td><input type="number" placeholder="No. of PWD" /></td>
      <td><button type="button" class="deleteRowBtn">Delete</button></td>
    `,l.appendChild(g),document.querySelectorAll(".deleteRowBtn").forEach(a=>{a.addEventListener("click",function(){this.closest("tr").remove()})})}),document.querySelectorAll(".removeRowBtn").forEach(l=>{l.addEventListener("click",function(){this.closest("tr").querySelectorAll("input").forEach(m=>m.value="")})})});
