import"./global-Dd8t204S.js";/* empty css                *//* empty css                 */document.addEventListener("DOMContentLoaded",()=>{const F={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};firebase.initializeApp(F);const I=firebase.database(),k=firebase.auth(),M=document.getElementById("exportExcelBtn"),j=document.getElementById("savePdfBtn");document.querySelector("#entriesInfo"),document.querySelector("#pagination");let g=[],y=[];const B=5;let b=1;k.onAuthStateChanged(s=>{if(!s){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to access RDANA logs."}).then(()=>{window.location.href="../pages/login.html"});return}console.log("User authenticated:",s.uid),z(s.uid)});function z(s){console.log("Loading approved reports for user:",s),I.ref("rdana/approved").on("value",e=>{g=[];const o=e.val();console.log("Approved reports snapshot:",o),o?Object.keys(o).forEach(c=>{const u=o[c];g.push({firebaseKey:c,...u})}):console.log("No approved reports found in rdana/approved"),y=[...g],$(y)},e=>{console.error("Error fetching approved RDANA reports:",e),Swal.fire({icon:"error",title:"Error",text:"Failed to load approved RDANA reports: "+e.message})})}function $(s){const e=document.querySelector("#orgTable tbody");e.innerHTML="";const o=s.length,c=Math.ceil(o/B);b>c&&(b=c||1);const u=(b-1)*B,h=u+B;s.slice(u,h).forEach((p,r)=>{var S,D,_,P;const d=document.createElement("tr");d.innerHTML=`
        <td>${u+r+1}</td>
        <td>${p.rdanaId}</td>
        <td>${new Date(p.dateTime).toLocaleString()}</td>
        <td>${((S=p.profile)==null?void 0:S.Site_Location_Address_Barangay)||p.siteLocation||"N/A"}</td>
        <td>${p.disasterType}</td>
        <td>${((D=p.effects)==null?void 0:D.affectedPopulation)??"N/A"}</td>
        <td>${((P=(_=p.needs)==null?void 0:_.priority)==null?void 0:P.join(", "))??"N/A"}</td>
        <td>
          <button class="viewBtn">View</button>
          <button class="deleteBtn">Remove</button>
          <button class="savePDFBtn">Save PDF</button>
        </td>
      `;const a=d.querySelector(".viewBtn"),v=d.querySelector(".deleteBtn"),A=d.querySelector(".savePDFBtn");a.addEventListener("click",()=>Y(u+r)),v.addEventListener("click",()=>G(p.firebaseKey,u+r)),A.addEventListener("click",()=>W(p)),e.appendChild(d)}),document.getElementById("entriesInfo").textContent=o>0?`Showing ${u+1} to ${Math.min(h,o)} of ${o} entries`:"No entries found",O(c)}function O(s){const e=document.getElementById("pagination");if(e.innerHTML="",s===0){e.innerHTML="<span>No entries to display</span>";return}const o=(t,p,r=!1,d=!1)=>{const a=document.createElement("button");return a.textContent=t,r&&(a.disabled=!0),d&&a.classList.add("active"),a.addEventListener("click",()=>{b=p,$(y)}),a};e.appendChild(o("Prev",b-1,b===1));const c=5;let u=Math.max(1,b-Math.floor(c/2)),h=Math.min(s,u+c-1);h-u<c-1&&(u=Math.max(1,h-c+1));for(let t=u;t<=h;t++)e.appendChild(o(t,t,!1,t===b));e.appendChild(o("Next",b+1,b===s))}function G(s,e){Swal.fire({title:"Are you sure?",text:"This will remove the RDANA log from the active list but keep it in the database for future access.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d9534f",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",background:"#fff",color:"#212529",iconColor:"#d9534f",position:"center",customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-text",confirmButton:"custom-confirm-btn",cancelButton:"custom-cancel-btn"},buttonsStyling:!1}).then(o=>{var c,u;if(o.isConfirmed){const h=(c=y[e])==null?void 0:c.userUid,t=(u=y[e])==null?void 0:u.rdanaId;if(!h||!t){console.error("Invalid userUid or rdanaId:",{userUid:h,rdanaId:t,log:y[e]}),Swal.fire({icon:"error",title:"Delete Error",text:"Invalid user or RDANA ID. Cannot delete."});return}I.ref("rdana/approved").orderByChild("rdanaId").equalTo(t).once("value").then(p=>{const r=p.val();if(!r)return console.warn(`RDANA log with rdanaId ${t} not found in rdana/approved. Proceeding with UI update.`),Promise.resolve();const d=Object.keys(r)[0],a=r[d];return!d||!a?(console.warn(`RDANA log with rdanaId ${t} not found in rdana/approved. Proceeding with UI update.`),Promise.resolve()):I.ref(`deletedrdana/${d}`).set({...a,deletedAt:new Date().toISOString()}).then(()=>({actualKey:d}))}).then(p=>{if(!p)return Promise.resolve();const{actualKey:r}=p;return Promise.all([I.ref(`rdana/approved/${r}`).remove(),I.ref(`users/${h}/rdanaReports/${r}`).remove()])}).then(()=>{y.splice(e,1);const p=g.findIndex(d=>d.rdanaId===t);p>-1&&g.splice(p,1);const r=Math.ceil(y.length/B);b>r&&(b=r||1),$(y),Swal.fire({icon:"success",title:"Deleted",text:"RDANA log has been moved to the deleted list or was already removed.",timer:2500,showConfirmButton:!1,background:"#fff5f5",color:"#b71c1c",iconColor:"#d32f2f",customClass:{popup:"swal2-popup-delete",title:"swal2-title-delete",content:"swal2-text-delete"}})}).catch(p=>{console.error("Delete error:",p),Swal.fire({icon:"error",title:"Delete Error",text:p.message})})}})}function Y(s){const e=y[s],o=document.getElementById("modalContent");let c="<h3>Profile of the Disaster</h3><div class='table-scroll'><table class='preview-table'>";c+=`<tr><td id='label'>Type of Disaster</td><td>${e.disasterType||"N/A"}</td></tr>`;for(const[a,v]of Object.entries(e.profile||{})){const A=x(a);c+=`<tr><td id='label'>${A}</td><td>${v}</td></tr>`}c+="</table></div>";let u="<h3>Modality of the Disaster</h3><div class='table-scroll'><table class='preview-table'>";for(const[a,v]of Object.entries(e.modality||{})){const A=x(a);u+=`<tr><td id='label'>${A}</td><td>${v}</td></tr>`}u+="</table></div>";let h=`<h3>Summary of Disaster/Incident</h3><p>${e.summary||"N/A"}</p>`,t=`<h3>Affected Communities</h3><div class='table-scroll'><table class='preview-table' id='rdanalog-table'><tr>
      <th>Community</th><th>Total Pop.</th><th>Affected Pop.</th><th>Deaths</th><th>Injured</th><th>Missing</th><th>Children</th><th>Women</th><th>Seniors</th><th>PWD</th></tr>`;(e.affectedCommunities||[]).forEach(a=>{t+=`<tr>
       <td>${a.community||"-"}</td>
        <td>${a.totalPop||0}</td>
        <td>${a.affected||0}</td>
        <td>${a.deaths||0}</td>
        <td>${a.injured||0}</td>
        <td>${a.missing||0}</td>
        <td>${a.children||0}</td>
        <td>${a.women||0}</td>
        <td>${a.seniors||0}</td>
        <td>${a.pwd||0}</td>
    </tr>`}),t+="</table></div>";let p="<h3>Status of Structures</h3><div class='table-scroll'><table class='preview-table' id='rdanalog-table'><tr><th>Structure</th><th>Status</th></tr>";(e.structureStatus||[]).forEach(a=>{p+=`<tr><td>${a.structure||"-"}</td><td>${a.status||"-"}</td></tr>`}),p+="</table></div>";let r="<h3>Initial Needs Assessment</h3><div class='table-scroll'><table class='preview-table' id='rdanalog-table'><tr><th>Item</th><th>Needed</th></tr>";(e.needsChecklist||[]).forEach(a=>{r+=`<tr><td>${a.item||"-"}</td><td>${a.needed?"Yes":"No"}</td></tr>`}),r+="</table></div>";let d=`
      <p><strong>Other Immediate Needs:</strong> ${e.otherNeeds||"N/A"}</p>
      <p><strong>Estimated Quantity:</strong> ${e.estQty||"N/A"}</p>
      <h3 style="margin-top: 15px; margin-bottom: 10px;">Initial Response Actions</h3>
      <p><strong>Response Groups Involved:</strong> ${e.responseGroup||"N/A"}</p>
      <p><strong>Relief Assistance Deployed:</strong> ${e.reliefDeployed||"N/A"}</p>
      <p><strong>Number of Families Served:</strong> ${e.familiesServed||"N/A"}</p>
    `;o.innerHTML=c+u+h+t+p+r+d,document.getElementById("previewModal").style.display="block"}document.getElementById("closeModal").addEventListener("click",()=>{document.getElementById("previewModal").style.display="none"});function x(s){return s.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim()}document.getElementById("searchInput").addEventListener("input",function(){const s=this.value.toLowerCase();y=g.filter(e=>{var o,c,u;return e.rdanaId.toLowerCase().includes(s)||(((o=e.profile)==null?void 0:o.Site_Location_Address_Barangay)||e.siteLocation||"").toLowerCase().includes(s)||e.disasterType.toLowerCase().includes(s)||((u=(c=e.needs)==null?void 0:c.priority)==null?void 0:u.join(", ").toLowerCase().includes(s))||!1}),b=1,$(y)});function R(s,e){var o,c,u,h;switch(e){case"DateTime":return new Date(s.dateTime).getTime();case"RDANAID":return parseInt(s.rdanaId.split("-")[1],10);case"Location":return(((o=s.profile)==null?void 0:o.Site_Location_Address_Barangay)||s.siteLocation||"").toLowerCase();case"DisasterType":return s.disasterType.toLowerCase();case"AffectedPopulation":return((c=s.effects)==null?void 0:c.affectedPopulation)??0;case"Needs":return(((h=(u=s.needs)==null?void 0:u.priority)==null?void 0:h.join(", "))??"").toLowerCase();default:return""}}document.getElementById("sortSelect").addEventListener("change",function(){const s=this.value;if(!s)y=[...g];else{const[e,o]=s.split("-");y.sort((c,u)=>{let h=R(c,e),t=R(u,e);return typeof h=="string"&&typeof t=="string"?o==="asc"?h.localeCompare(t):t.localeCompare(h):o==="asc"?h-t:t-h})}b=1,$(y)}),M.addEventListener("click",H);function H(){if(g.length===0){Swal.fire({icon:"info",title:"No Data to Export",text:"There are no RDANA logs to save to Excel."});return}const s=g.map(t=>{var r,d,a,v,A,S,D,_,P,f,w,i,l,N,T,L,C,E,m;return{"RDANA ID":t.rdanaId||"N/A","Record Date/Time":t.dateTime?new Date(t.dateTime).toLocaleString():"N/A","User UID":t.userUid||"N/A",Status:t.status||"N/A","Profile - Date of Information Gathered":((r=t.profile)==null?void 0:r.Date_of_Information_Gathered)||"N/A","Profile - Date of Occurrence":((d=t.profile)==null?void 0:d.Date_of_Occurrence)||"N/A","Profile - Local Authorities Persons Contacted":((a=t.profile)==null?void 0:a.Local_Authorities_Persons_Contacted_for_Information)||"N/A","Profile - Locations & Areas Affected (Barangay)":((v=t.profile)==null?void 0:v.Locations_and_Areas_Affected_Barangay)||"N/A","Profile - Locations & Areas Affected (City/Municipality)":((A=t.profile)==null?void 0:A.Locations_and_Areas_Affected_City_Municipality)||"N/A","Profile - Locations & Areas Affected (Province)":((S=t.profile)==null?void 0:S.Locations_and_Areas_Affected_Province)||"N/A","Profile - Name of Organizations Involved":((D=t.profile)==null?void 0:D.Name_of_the_Organizations_Involved)||"N/A","Profile - Site Location Address (Barangay)":((_=t.profile)==null?void 0:_.Site_Location_Address_Barangay)||"N/A","Profile - Site Location Address (City/Municipality)":((P=t.profile)==null?void 0:P.Site_Location_Address_City_Municipality)||"N/A","Profile - Site Location Address (Province)":((f=t.profile)==null?void 0:f.Site_Location_Address_Province)||"N/A","Profile - Time of Information Gathered":((w=t.profile)==null?void 0:w.Time_of_Information_Gathered)||"N/A","Profile - Time of Occurrence":((i=t.profile)==null?void 0:i.Time_of_Occurrence)||"N/A","Profile - Type of Disaster":((l=t.profile)==null?void 0:l.Type_of_Disaster)||"N/A","Disaster Type":t.disasterType||"N/A","Modality - Date and Time of Occurrence":((N=t.modality)==null?void 0:N.Date_and_Time_of_Occurrence)||"N/A","Modality - Locations and Areas Affected":((T=t.modality)==null?void 0:T.Locations_and_Areas_Affected)||"N/A","Modality - Type of Disaster (Modality)":((L=t.modality)==null?void 0:L.Type_of_Disaster)||"N/A","Summary of Disaster/Incident":t.summary||"N/A","Effects - Affected Population":((C=t.effects)==null?void 0:C.affectedPopulation)??"N/A","Affected Communities - Community":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.community).filter(Boolean).join(", "):"N/A","Affected Communities - Total Pop.":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.totalPop).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Affected Pop.":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.affected).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Deaths":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.deaths).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Injured":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.injured).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Missing":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.missing).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Children":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.children).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Women":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.women).filter(n=>n!=null).join(", "):"N/A","Affected Communities - Seniors":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.seniors).filter(n=>n!=null).join(", "):"N/A","Affected Communities - PWD":Array.isArray(t.affectedCommunities)?t.affectedCommunities.map(n=>n.pwd).filter(n=>n!=null).join(", "):"N/A","Structure Status Details":Array.isArray(t.structureStatus)?t.structureStatus.map(n=>`${n.structure||"N/A"}: ${n.status||"N/A"}`).filter(Boolean).join("; "):"N/A","Needs - Priority List":((m=(E=t.needs)==null?void 0:E.priority)==null?void 0:m.join(", "))||"N/A","Needs Checklist - Items & Needed Status":Array.isArray(t.needsChecklist)?t.needsChecklist.map(n=>`${n.item||"N/A"}: ${n.needed?"Yes":"No"}`).filter(Boolean).join("; "):"N/A","Other Immediate Needs":t.otherNeeds||"N/A","Estimated Quantity":t.estQty||"N/A","Response Groups Involved":t.responseGroup||"N/A","Relief Assistance Deployed":t.reliefDeployed||"N/A","Number of Families Served":t.familiesServed||"N/A","Site Location (Top Level)":t.siteLocation||"N/A"}}),e=XLSX.utils.json_to_sheet(s),o=XLSX.utils.book_new();XLSX.utils.book_append_sheet(o,e,"RDANA Logs");const h=`RDANA_Logs_${new Date().toISOString().slice(0,10)}.xlsx`;XLSX.writeFile(o,h),Swal.fire({icon:"success",title:"Export Successful!",text:`All RDANA logs have been saved to "${h}".`})}j.addEventListener("click",()=>{Swal.fire({title:"Generating PDF...",text:"Please wait while the PDF file is being created.",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}}),U()});async function U(){const{jsPDF:s}=window.jspdf,e=new s("portrait"),o=y;if(o.length===0){Swal.close(),Swal.fire({icon:"info",title:"No Data to Export",text:"There are no RDANA logs matching your current search/sort criteria to export to PDF."});return}const c=new Image;c.src="../assets/images/AB_logo.png",c.onload=function(){const u=e.internal.pageSize.width,h=e.internal.pageSize.height,t=30,p=c.naturalHeight/c.naturalWidth*t,r=14,d=r,a=u-2*r,v=(f,w,i)=>{let l=r;f.addImage(c,"PNG",u-t-r,r,t,p),f.setFontSize(18),f.text("RDANA Logs Report",r,l+8),l+=18,f.setFontSize(10),f.text(`Report Generated: ${new Date().toLocaleString()}`,r,l),l+=15,f.setFontSize(8);const N=h-10;return f.text(`Page ${w} of ${i}`,r,N),f.text("Powered by: Appvance",u-r,N,{align:"right"}),l},A=(f,w,i,l,N,T=5)=>{const L=`${w}: ${i||"N/A"}`,C=f.splitTextToSize(L,N);return f.text(C,r,l),l+C.length*T+2},S=(f,w,i)=>(f.setFontSize(12),f.setTextColor(20,174,187),f.text(w,r,i),f.setTextColor(0),i+7);let D=1;o.forEach((f,w)=>{w>0&&(e.addPage(),D++);let i=v(e,D,o.length);e.setFontSize(14),e.setTextColor(20,174,187),e.text(`RDANA ID: ${f.rdanaId||"N/A"}`,d,i),i+=10,e.setTextColor(0),e.setFontSize(10),i=A(e,"Record Date/Time",f.dateTime?new Date(f.dateTime).toLocaleString():"N/A",i,a),i=A(e,"Disaster Type",f.disasterType||"N/A",i,a),i=A(e,"User UID",f.userUid||"N/A",i,a),i=A(e,"Status",f.status||"N/A",i,a),i+=5,i=S(e,"Profile of the Disaster",i),e.setFontSize(10);for(const[m,n]of Object.entries(f.profile||{}))i=A(e,x(m),n,i,a);i+=5,i=S(e,"Modality of the Disaster",i),e.setFontSize(10);for(const[m,n]of Object.entries(f.modality||{}))i=A(e,x(m),n,i,a);i+=5,i=S(e,"Summary of Disaster/Incident",i),e.setFontSize(10),i=A(e,"Summary",f.summary||"N/A",i,a),i+=5,i=S(e,"Affected Communities",i),e.setFontSize(8);const l=["Community","Total Pop.","Affected Pop.","Deaths","Injured","Missing","Children","Women","Seniors","PWD"],N=(f.affectedCommunities||[]).map(m=>[m.community||"-",m.totalPop||0,m.affected||0,m.deaths||0,m.injured||0,m.missing||0,m.children||0,m.women||0,m.seniors||0,m.pwd||0]);e.autoTable({startY:i,head:[l],body:N,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[20,174,187]},margin:{left:r,right:r},didDrawPage:function(m){i=m.cursor.y+5},didParseCell:function(m){m.section==="body"&&m.column.index===0&&(m.cell.styles.fontStyle="bold")}}),e.autoTable.previous.finalY&&(i=e.autoTable.previous.finalY+5),i=S(e,"Status of Structures",i),e.setFontSize(8);const T=["Structure","Status"],L=(f.structureStatus||[]).map(m=>[m.structure||"-",m.status||"-"]);e.autoTable({startY:i,head:[T],body:L,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[20,174,187]},margin:{left:r,right:r},didDrawPage:function(m){i=m.cursor.y+5}}),e.autoTable.previous.finalY&&(i=e.autoTable.previous.finalY+5),i=S(e,"Initial Needs Assessment",i),e.setFontSize(8);const C=["Item","Needed"],E=(f.needsChecklist||[]).map(m=>[m.item||"-",m.needed?"Yes":"No"]);e.autoTable({startY:i,head:[C],body:E,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[20,174,187]},margin:{left:r,right:r},didDrawPage:function(m){i=m.cursor.y+5}}),e.autoTable.previous.finalY&&(i=e.autoTable.previous.finalY+5),i=S(e,"Other Needs and Response",i),e.setFontSize(10),i=A(e,"Other Immediate Needs",f.otherNeeds||"N/A",i,a),i=A(e,"Estimated Quantity",f.estQty||"N/A",i,a),i=A(e,"Response Groups Involved",f.responseGroup||"N/A",i,a),i=A(e,"Relief Assistance Deployed",f.reliefDeployed||"N/A",i,a),i=A(e,"Number of Families Served",f.familiesServed||"N/A",i,a)});const P=new Date().toISOString().slice(0,10);e.save(`Approved_RDANA_Logs_${P}.pdf`),Swal.close(),Swal.fire({title:"Success!",text:"PDF file generated successfully!",icon:"success",timer:1500,showConfirmButton:!1,color:"#1b5e20",iconColor:"#43a047",confirmButtonColor:"#388e3c",confirmButtonText:"Great!",customClass:{popup:"swal2-popup-success-export",title:"swal2-title-success-export",content:"swal2-text-success-export",confirmButton:"swal2-button-success-export"}})},c.onerror=function(){Swal.close(),Swal.fire("Error","Failed to load logo image at ../assets/images/AB_logo.png. Please check the path.","error")}}function W(s){const{jsPDF:e}=window.jspdf,o=new e("portrait"),c=new Image;c.src="../assets/images/AB_logo.png",c.onload=function(){const u=o.internal.pageSize.width,h=o.internal.pageSize.height,t=30,p=c.naturalHeight/c.naturalWidth*t,r=14;let d=r;o.addImage(c,"PNG",u-t-r,r,t,p),o.setFontSize(18),o.text("RDANA Log Details",r,d+8),d+=18,o.setFontSize(10),o.text(`Report Generated: ${new Date().toLocaleString()}`,r,d),d+=15;const a=(l,N,T=!1)=>{if(d>h-r-20&&(o.addPage(),d=r,o.addImage(c,"PNG",u-t-r,r,t,p),o.setFontSize(14),o.text("RDANA Log Details (Cont.)",r,d+8),d+=18),o.setFontSize(T?12:10),T)o.setTextColor(20,174,187),o.text(`${l}`,r,d),o.setTextColor(0),d+=7;else{const L=`${l}: ${N||"N/A"}`,C=o.splitTextToSize(L,u-2*r);o.text(C,r,d),d+=C.length*5+2}};a("RDANA ID",s.rdanaId||"N/A"),a("Record Date/Time",s.dateTime?new Date(s.dateTime).toLocaleString():"N/A"),a("Disaster Type",s.disasterType||"N/A"),a("User UID",s.userUid||"N/A"),a("Status",s.status||"N/A"),d+=5,a("Profile of the Disaster","",!0);for(const[l,N]of Object.entries(s.profile||{}))a(x(l),N);d+=5,a("Modality of the Disaster","",!0);for(const[l,N]of Object.entries(s.modality||{}))a(x(l),N);d+=5,a("Summary of Disaster/Incident","",!0),a("Summary",s.summary||"N/A"),d+=5,a("Affected Communities","",!0),o.setFontSize(8);const v=["Community","Total Pop.","Affected Pop.","Deaths","Injured","Missing","Children","Women","Seniors","PWD"],A=(s.affectedCommunities||[]).map(l=>[l.community||"-",l.totalPop||0,l.affected||0,l.deaths||0,l.injured||0,l.missing||0,l.children||0,l.women||0,l.seniors||0,l.pwd||0]);o.autoTable({startY:d,head:[v],body:A,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[20,174,187]},margin:{left:r,right:r},didDrawPage:function(l){d=l.cursor.y+5},didParseCell:function(l){l.section==="body"&&l.column.index===0&&(l.cell.styles.fontStyle="bold")}}),o.autoTable.previous.finalY&&(d=o.autoTable.previous.finalY+5),d+=5,a("Status of Structures","",!0),o.setFontSize(8);const S=["Structure","Status"],D=(s.structureStatus||[]).map(l=>[l.structure||"-",l.status||"-"]);o.autoTable({startY:d,head:[S],body:D,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[20,174,187]},margin:{left:r,right:r},didDrawPage:function(l){d=l.cursor.y+5}}),o.autoTable.previous.finalY&&(d=o.autoTable.previous.finalY+5),d+=5,a("Initial Needs Assessment","",!0),o.setFontSize(8);const _=["Item","Needed"],P=(s.needsChecklist||[]).map(l=>[l.item||"-",l.needed?"Yes":"No"]);o.autoTable({startY:d,head:[_],body:P,theme:"grid",styles:{fontSize:7,cellPadding:1,overflow:"linebreak"},headStyles:{fillColor:[20,174,187]},margin:{left:r,right:r},didDrawPage:function(l){d=l.cursor.y+5}}),o.autoTable.previous.finalY&&(d=o.autoTable.previous.finalY+5),d+=5,a("Other Needs and Response","",!0),a("Other Immediate Needs",s.otherNeeds||"N/A"),a("Estimated Quantity",s.estQty||"N/A"),a("Response Groups Involved",s.responseGroup||"N/A"),a("Relief Assistance Deployed",s.reliefDeployed||"N/A"),a("Number of Families Served",s.familiesServed||"N/A"),o.setFontSize(8);const f=h-10,w=`Page ${o.internal.getNumberOfPages()}`,i="Powered by: Appvance";o.text(w,r,f),o.text(i,u-r,f,{align:"right"}),o.save(`RDANA_Log_${s.rdanaId}.pdf`),Swal.fire({icon:"success",title:"PDF Generated!",text:`RDANA Log "${s.rdanaId}" saved as PDF.`,timer:2e3,showConfirmButton:!1,color:"#1b5e20",iconColor:"#43a047",confirmButtonColor:"#388e3c",confirmButtonText:"Great!",customClass:{popup:"swal2-popup-success-export",title:"swal2-title-success-export",content:"swal2-text-success-export",confirmButton:"swal2-button-success-export"}})},c.onerror=function(){Swal.fire("Error","Failed to load logo image. Please check the path.","error")}}});
