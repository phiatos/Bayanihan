import"./global-Dd8t204S.js";/* empty css                *//* empty css                 */document.addEventListener("DOMContentLoaded",()=>{const D={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};firebase.initializeApp(D);const p=firebase.database(),b=firebase.auth();let u=1;const g=5,C=document.getElementById("submittedReportsContainer"),h=document.getElementById("pagination"),I=document.getElementById("entriesInfo"),v=document.getElementById("searchInput"),y=document.getElementById("sortSelect");b.onAuthStateChanged(e=>{if(!e){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to access RDANA reports."}).then(()=>{window.location.href="../pages/login.html"});return}console.log("User authenticated:",e.uid),N(e.uid)});function N(e){console.log("Loading submitted reports for user:",e),p.ref("rdana/submitted").on("value",t=>{let a=[];const o=t.val();console.log("Submitted reports snapshot:",o),o?Object.keys(o).forEach(n=>{const s=o[n];a.push({firebaseKey:n,...s})}):console.log("No submitted reports found in rdana/submitted"),m(a)},t=>{console.error("Error fetching submitted RDANA reports:",t),Swal.fire({icon:"error",title:"Error",text:"Failed to load submitted RDANA reports: "+t.message})})}function R(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function $(e,t){var a,o,n;switch(t){case"DateTime":return new Date(e.dateTime).getTime();case"RDANAID":return parseInt(e.rdanaId.split("-")[1],10);case"Location":return e.siteLocation.toLowerCase();case"DisasterType":return e.disasterType.toLowerCase();case"AffectedPopulation":return((a=e.effects)==null?void 0:a.affectedPopulation)??0;case"Needs":return(((n=(o=e.needs)==null?void 0:o.priority)==null?void 0:n.join(", "))??"").toLowerCase();default:return""}}function m(e=[]){let t=[...e];const a=v.value.toLowerCase();a&&(t=t.filter(n=>{var s,i;return n.rdanaId.toLowerCase().includes(a)||n.siteLocation.toLowerCase().includes(a)||n.disasterType.toLowerCase().includes(a)||((i=(s=n.needs)==null?void 0:s.priority)==null?void 0:i.join(", ").toLowerCase().includes(a))||!1}));const o=y.value;if(o){const[n,s]=o.split("-");t.sort((i,c)=>{const d=$(i,n),l=$(c,n);return typeof d=="string"&&typeof l=="string"?s==="asc"?d.localeCompare(l):l.localeCompare(d):s==="asc"?d-l:l-d})}E(t)}function E(e){C.innerHTML="";const t=(u-1)*g,a=e.slice(t,t+g);I.textContent=`Showing ${t+1} to ${t+a.length} of ${e.length} entries`,a.forEach((o,n)=>{var i,c,d,l;const s=document.createElement("tr");s.innerHTML=`
        <td>${t+n+1}</td>
        <td>${o.rdanaId}</td>
        <td>${R(o.dateTime)}</td>
        <td>${((i=o.profile)==null?void 0:i.Site_Location_Address_Barangay)||"N/A"}</td>
        <td>${o.disasterType}</td>
        <td>${(c=o.effects)==null?void 0:c.affectedPopulation}</td>
        <td>${((l=(d=o.needs)==null?void 0:d.priority)==null?void 0:l.join(", "))??"N/A"}</td>
        <td>
          <button class="viewBtn">View</button>
          <button class="approveBtn">Approve</button>
          <button class="rejectBtn">Reject</button>
        </td>
      `,s.querySelector(".viewBtn").addEventListener("click",()=>B(o)),s.querySelector(".approveBtn").addEventListener("click",()=>M(o)),s.querySelector(".rejectBtn").addEventListener("click",()=>j(o)),C.appendChild(s),console.log("Verifying Report:",o)}),T(e.length)}function T(e){const t=Math.ceil(e/g);if(h.innerHTML="",t===0){h.innerHTML="<span>No entries to display</span>";return}const a=(i,c,d=!1,l=!1)=>{const f=document.createElement("button");return f.textContent=i,d&&(f.disabled=!0),l&&f.classList.add("active-page"),f.addEventListener("click",()=>{u=c,m()}),f};h.appendChild(a("Prev",u-1,u===1));const o=5;let n=Math.max(1,u-Math.floor(o/2)),s=Math.min(t,n+o-1);s-n<o-1&&(n=Math.max(1,s-o+1));for(let i=n;i<=s;i++)h.appendChild(a(i,i,!1,i===u));h.appendChild(a("Next",u+1,u===t))}function L(e){return e.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim()}function B(e){const t=document.getElementById("previewModal"),a=document.getElementById("modalContent");let o="<h3>Profile of the Disaster</h3><div class='table-scroll'><table class='preview-table'>";o+=`<tr><td id='label'>Type of Disaster</td><td>${e.disasterType||"N/A"}</td></tr>`;for(const[r,A]of Object.entries(e.profile||{})){const w=L(r);o+=`<tr><td id='label'>${w}</td><td>${A}</td></tr>`}o+="</table></div>";let n="<h3>Modality of the Disaster</h3><div class='table-scroll'><table class='preview-table'>";for(const[r,A]of Object.entries(e.modality||{})){const w=L(r);n+=`<tr><td id='label'>${w}</td><td>${A}</td></tr>`}n+="</table></div>";let s=`<h3>Summary of Disaster/Incident</h3><p>${e.summary||"N/A"}</p>`,i=`<h3>Affected Communities</h3><div class='table-scroll'><table class='preview-table' id='rdanalog-table'><tr>
        <th>Community</th><th>Total Pop.</th><th>Affected Pop.</th><th>Deaths</th><th>Injured</th><th>Missing</th><th>Children</th><th>Women</th><th>Seniors</th><th>PWD</th></tr>`;(e.affectedCommunities||[]).forEach(r=>{i+=`<tr>
            <td>${r.community||"-"}</td>
            <td>${r.totalPop||0}</td>
            <td>${r.affected||0}</td>
            <td>${r.deaths||0}</td>
            <td>${r.injured||0}</td>
            <td>${r.missing||0}</td>
            <td>${r.children||0}</td>
            <td>${r.women||0}</td>
            <td>${r.seniors||0}</td>
            <td>${r.pwd||0}</td>
        </tr>`}),i+="</table></div>";let c="<h3>Status of Structures</h3><div class='table-scroll'><table class='preview-table' id='rdanalog-table'><tr><th>Structure</th><th>Status</th></tr>";(e.structureStatus||[]).forEach(r=>{c+=`<tr><td>${r.structure||"-"}</td><td>${r.status||"-"}</td></tr>`}),c+="</table></div>";let d="<h3>Initial Needs Assessment</h3><div class='table-scroll'><table class='preview-table' id='rdanalog-table'><tr><th>Item</th><th>Needed</th></tr>";(e.needsChecklist||[]).forEach(r=>{d+=`<tr><td>${r.item||"-"}</td><td>${r.needed?"Yes":"No"}</td></tr>`}),d+="</table></div>";let l=`
        <p><strong>Other Immediate Needs:</strong> ${e.otherNeeds||"N/A"}</p>
        <p><strong>Estimated Quantity:</strong> ${e.estQty||"N/A"}</p>
        <h3 style="margin-top: 15px; margin-bottom: 10px;">Initial Response Actions</h3>
        <p><strong>Response Groups Involved:</strong> ${e.responseGroup||"N/A"}</p>
        <p><strong>Relief Assistance Deployed:</strong> ${e.reliefDeployed||"N/A"}</p>
        <p><strong>Number of Families Served:</strong> ${e.familiesServed||"N/A"}</p>
    `;a.innerHTML=o+n+s+i+c+d+l,t.style.display="block";const f=document.getElementById("closeModal");f.onclick=()=>{t.style.display="none"},window.onclick=r=>{r.target===t&&(t.style.display="none")}}function M(e){b.onAuthStateChanged(t=>{if(!t){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to approve reports."}).then(()=>{window.location.href="../pages/login.html"});return}console.log("Attempting to approve report:",e.rdanaId),p.ref(`users/${t.uid}/role`).once("value",a=>{e.status="Approved",Promise.all([p.ref("rdana/approved").push(e),p.ref(`users/${e.userUid}/rdanaReports/${e.firebaseKey}`).set({...e,status:"Approved"}),p.ref(`rdana/submitted/${e.firebaseKey}`).remove()]).then(()=>{console.log("RDANA report approved and moved to rdana/approved"),Swal.fire({icon:"success",title:"Report Approved",text:"The RDANA report has been approved and moved to the logs.",background:"#e6ffed",color:"#1e4620",iconColor:"#22c55e",confirmButtonColor:"#16a34a",timer:2500,showConfirmButton:!1,customClass:{popup:"swal2-popup-success-clean",title:"swal2-title-success-clean",content:"swal2-text-success-clean"}})}).catch(o=>{console.error("Error during RDANA report approval:",o),Swal.fire({icon:"error",title:"Approval Failed",text:"Failed to approve RDANA report: "+o.message,background:"#fdecea",color:"#611a15",iconColor:"#e02424",confirmButtonColor:"#b91c1c",timer:3500,showConfirmButton:!0,customClass:{popup:"swal2-popup-error-clean",title:"swal2-title-error-clean",content:"swal2-text-error-clean"}})})})})}function j(e){b.onAuthStateChanged(t=>{if(!t){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to reject reports."}).then(()=>{window.location.href="../pages/login.html"});return}console.log("Attempting to reject report:",e.rdanaId),Promise.all([p.ref(`rdana/submitted/${e.firebaseKey}`).remove(),p.ref(`users/${e.userUid}/rdanaReports/${e.firebaseKey}`).remove()]).then(()=>{console.log("RDANA report rejected and removed"),Swal.fire({icon:"error",title:"Report Rejected",text:"The RDANA report has been rejected and removed from the system.",background:"#f8d7da",color:"#721c24",iconColor:"#b02a37",confirmButtonColor:"#b02a37",timer:3e3,showConfirmButton:!0})}).catch(a=>{console.error("Error during RDANA report rejection:",a),Swal.fire({icon:"error",title:"Error",text:"Failed to reject RDANA report: "+a.message})})})}const S=document.getElementById("viewApprovedBtn");S&&S.addEventListener("click",()=>{window.location.href="../pages/rdanaLog.html"}),v&&y&&(v.addEventListener("input",()=>m()),y.addEventListener("change",()=>m()))});
