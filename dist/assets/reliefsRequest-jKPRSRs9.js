import"./global-Dd8t204S.js";/* empty css                */document.addEventListener("DOMContentLoaded",()=>{const T={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};try{firebase.initializeApp(T),console.log("Firebase initialized successfully")}catch(e){console.error("Firebase initialization failed:",e)}const x=firebase.database(),M=firebase.auth(),m=document.getElementById("form-page-1"),r=document.getElementById("form-page-2"),P=document.getElementById("nextBtn"),k=document.getElementById("backBtn"),L=document.getElementById("addItemBtn"),c=document.getElementById("itemsTable"),g=c?c.querySelector("tbody"):null,q=document.getElementById("previewContact"),b=document.getElementById("previewItemsTable"),p=document.getElementById("contactPerson"),f=document.getElementById("contactNumber"),y=document.getElementById("email"),I=document.getElementById("address"),h=document.getElementById("city"),v=document.getElementById("category"),C=document.getElementById("itemName"),B=document.getElementById("quantity"),E=document.getElementById("notes");if(!m||!r||!P||!k||!L||!c||!g||!q||!b||!p||!f||!y||!I||!h||!v||!C||!B||!E){console.error("One or more DOM elements are missing:",{formPage1:!!m,formPage2:!!r,nextBtn:!!P,backBtn:!!k,addItemBtn:!!L,itemsTable:!!c,itemsTableBody:!!g,previewContact:!!q,previewItemsTable:!!b,contactPersonInput:!!p,contactNumberInput:!!f,emailInput:!!y,addressInput:!!I,cityInput:!!h,donationCategoryInput:!!v,itemNameInput:!!C,quantityInput:!!B,notesInput:!!E});return}const l=[];let d=null,w="[Unknown Org]";M.onAuthStateChanged(e=>{e?(d=e.uid,console.log("Logged-in user UID:",d),x.ref(`users/${d}`).once("value",t=>{const n=t.val();n&&n.group?(w=n.group,console.log("Volunteer group fetched from database:",w),p.value=n.contactPerson||"",f.value=n.mobile||"",y.value=n.email||""):console.warn("User data or group not found in database for UID:",d)}).catch(t=>{console.error("Error fetching user data:",t)})):(console.warn("No user is logged in"),Swal.fire({icon:"error",title:"Not Logged In",text:"Please log in to submit a relief request."}).then(()=>{window.location.href="../pages/login.html"}))}),c.style.display="none",document.getElementById("contactPerson").addEventListener("input",function(e){this.value=this.value.replace(/[^a-zA-Z\s]/g,"")}),document.getElementById("contactNumber").addEventListener("input",function(e){this.value=this.value.replace(/[^0-9+\-\s()]/g,"")}),document.getElementById("email").addEventListener("input",function(e){this.value=this.value.replace(/\s/g,"")}),document.getElementById("address").addEventListener("input",function(e){this.value=this.value.replace(/[^a-zA-Z0-9\s,.'-]/g,"")}),document.getElementById("city").addEventListener("input",function(e){this.value=this.value.replace(/[^a-zA-Z\sñÑ]/g,"")}),document.getElementById("category").addEventListener("change",function(){const e=this.value,t=document.getElementById("itemName"),n=document.getElementById("quantity"),i=document.getElementById("notes");t.disabled=!1,n.disabled=!1,i.disabled=!1;const o=document.getElementById("itemNameList");for(;o.firstChild;)o.removeChild(o.firstChild);let a=[];e==="Food"?a=["Rice","Canned Goods","Water Bottles"]:e==="Clothing"?a=["Blankets"]:e==="Medicine"?a=["Medicine Kits"]:e==="Hygiene"?a=["Hygiene Packs"]:a=["Others"],a.forEach(u=>{const s=document.createElement("option");s.value=u,o.appendChild(s)})}),L.addEventListener("click",()=>{console.log("Add Item button clicked");const e=C.value.trim(),t=B.value.trim(),n=E.value.trim();if(console.log("Add Item inputs:",{name:e,quantity:t,notes:n}),!e){console.log("Validation failed: Item name is empty"),Swal.fire({icon:"warning",title:"Missing Item Name",text:"Please enter the item name.",timer:2200,showConfirmButton:!1,timerProgressBar:!0,customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",content:"swal2-text-warning-clean"}});return}if(!t||parseInt(t)<=0){console.log("Validation failed: Invalid quantity",{quantity:t}),Swal.fire({icon:"warning",title:"Invalid Quantity",text:"Please enter a quantity greater than 0.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}const i=l.length;l.push({name:e,quantity:t,notes:n}),console.log("Item added:",{name:e,quantity:t,notes:n,itemIndex:i});const o=document.createElement("tr");o.innerHTML=`
            <td id="prevItmName">${e}</td>
            <td id="prevQty">${t}</td>
            <td id="prevNotes">${n}</td>
            <td><button type="button" class="delete-btn" id="deleteItmBtn" data-index="${i}">Delete</button></td>
        `,g.appendChild(o),c.style.display="table",C.value="",B.value="",E.value=""}),g.addEventListener("click",e=>{if(e.target.classList.contains("delete-btn")){console.log("Delete button clicked");const t=parseInt(e.target.getAttribute("data-index"));l.splice(t,1),N()}});function N(){console.log("Rendering items table"),g.innerHTML="",l.forEach((e,t)=>{const n=document.createElement("tr");n.innerHTML=`
                <td>${e.name}</td>
                <td>${e.quantity}</td>
                <td>${e.notes}</td>
                <td><button type="button" class="delete-btn" data-index="${t}">Delete</button></td>
            `,g.appendChild(n)}),c.style.display=l.length>0?"table":"none"}P.addEventListener("click",()=>{console.log("Proceed button clicked");const e=p.value.trim(),t=f.value.trim(),n=y.value.trim(),i=I.value.trim(),o=h.value.trim(),a=v.value;if(console.log("Proceed inputs:",{contactPerson:e,contactNumber:t,email:n,address:i,city:o,donationCategory:a,addedItemsLength:l.length,volunteerOrganization:w}),!e){console.log("Validation failed: Contact person is empty"),Swal.fire({icon:"warning",title:"Missing Contact Person",text:"Please enter the contact person’s name.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}if(!t||!/^\d{10,}$/.test(t)){console.log("Validation failed: Invalid contact number",{contactNumber:t}),Swal.fire({icon:"warning",title:"Invalid Contact Number",text:"Please enter a valid contact number (at least 10 digits).",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}if(!n||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){console.log("Validation failed: Invalid email",{email:n}),Swal.fire({icon:"warning",title:"Invalid Email",text:"Please enter a valid email address.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}if(!i){console.log("Validation failed: Address is empty"),Swal.fire({icon:"warning",title:"Missing Address",text:"Please enter the drop-off address.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}if(!o){console.log("Validation failed: City is empty"),Swal.fire({icon:"warning",title:"Missing City",text:"Please enter the city.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}if(!a){console.log("Validation failed: Donation category not selected"),Swal.fire({icon:"warning",title:"Missing Category",text:"Please select a donation category.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}if(l.length===0){console.log("Validation failed: No items added"),Swal.fire({icon:"warning",title:"No Items Added",text:"Please add at least one item before proceeding.",background:"#fefefe",color:"#6c584c",iconColor:"#d18f00",confirmButtonColor:"#d18f00",customClass:{popup:"swal2-popup-warning-clean",title:"swal2-title-warning-clean",htmlContainer:"swal2-text-warning-clean"}});return}m.style.display="none",r.style.display="block",console.log("Switched to form-page-2"),q.innerHTML=`
            <p><strong>Contact Person:</strong> ${e}</p>
            <p><strong>Contact Number:</strong> ${t}</p>
            <p><strong>Email:</strong> ${n}</p>
            <p><strong>Address:</strong> ${i}, ${o}</p>
            <p><strong>Donation Category:</strong> ${a}</p>
            <p><strong>Volunteer Organization:</strong> ${w}</p>
        `,b.innerHTML="",l.forEach(u=>{const s=document.createElement("tr");s.innerHTML=`<td>${u.name}</td><td>${u.quantity}</td><td>${u.notes}</td>`,b.appendChild(s)})}),k.addEventListener("click",()=>{console.log("Back button clicked"),r.style.display="none",m.style.display="block"}),r.addEventListener("submit",e=>{if(e.preventDefault(),console.log("Submit button clicked"),!d){console.error("No user UID available. Cannot submit request."),Swal.fire({icon:"error",title:"Authentication Error",text:"User not authenticated. Please log in again."}).then(()=>{window.location.href="../pages/login.html"});return}const t=p.value.trim(),n=f.value.trim(),i=y.value.trim(),o=I.value.trim(),a=h.value.trim(),u=v.value,s={contactPerson:t,contactNumber:n,email:i,address:o,city:a,category:u,volunteerOrganization:w,userUid:d,items:l,timestamp:firebase.database.ServerValue.TIMESTAMP},$=x.ref("requestRelief/requests").push(),A=x.ref(`users/${d}/requests/${$.key}`);Promise.all([$.set(s),A.set(s)]).then(()=>{console.log("Data saved to Firebase successfully"),Swal.fire({icon:"success",title:"Request Submitted",text:"Your relief request has been successfully submitted!"}).then(()=>{m.reset(),r.reset(),l.length=0,N(),r.style.display="none",m.style.display="block"})}).catch(S=>{console.error("Failed to save data to Firebase:",S),Swal.fire({icon:"error",title:"Error",text:"Failed to submit request: "+S.message})})})});
