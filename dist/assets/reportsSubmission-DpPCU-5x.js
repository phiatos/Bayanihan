import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                *//* empty css               */let a,I=[],A;function J(){const b={lat:14.5995,lng:120.9842};a=new google.maps.Map(document.getElementById("mapContainer"),{center:b,zoom:10,mapTypeId:"roadmap"});const S=document.getElementById("search-input");A=new google.maps.places.Autocomplete(S),A.bindTo("bounds",a),A.addListener("place_changed",()=>{const o=A.getPlace();if(!o.geometry||!o.geometry.location){Swal.fire({icon:"error",title:"Location Not Found",text:"Please select a valid location from the dropdown."});return}a.setCenter(o.geometry.location),a.setZoom(16),Q();const t=new google.maps.Marker({position:o.geometry.location,map:a,title:o.name});I.push(t);const i=new google.maps.InfoWindow({content:`<strong>${o.name}</strong><br>${o.formatted_address}`});t.addListener("click",()=>{i.open(a,t)}),i.open(a,t);const u=document.getElementById("AreaOfOperation");u&&(u.value=o.formatted_address);const f=document.getElementById("mapModal");f&&f.classList.remove("show")}),a.addListener("click",o=>{Q();const t=new google.maps.Marker({position:o.latLng,map:a,title:"Pinned Location"});I.push(t),new google.maps.Geocoder().geocode({location:o.latLng},(u,f)=>{if(f==="OK"&&u[0]){const g=u[0].formatted_address,p=new google.maps.InfoWindow({content:`Pinned Location<br>${g}`});t.addListener("click",()=>{p.open(a,t)}),p.open(a,t);const d=document.getElementById("AreaOfOperation");d&&(d.value=g);const r=document.getElementById("mapModal");r&&r.classList.remove("show")}else{console.error("Geocoder failed due to: "+f),Swal.fire({icon:"error",title:"Geocoding Error",text:"Unable to retrieve address for the pinned location."});const g=document.getElementById("AreaOfOperation");g&&(g.value=`Lat: ${o.latLng.lat()}, Lng: ${o.latLng.lng()}`);const p=document.getElementById("mapModal");p&&p.classList.remove("show")}}),a.setCenter(o.latLng),a.setZoom(16)}),navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{const t={lat:o.coords.latitude,lng:o.coords.longitude};a.setCenter(t),a.setZoom(16);const i=new google.maps.Marker({position:t,map:a,title:"You are here",icon:{url:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}});I.push(i);const u=new google.maps.InfoWindow({content:"You are here"});i.addListener("click",()=>{u.open(a,i)}),u.open(a,i),console.log("User location:",t)},o=>{console.error("Geolocation error:",o);let t="Unable to retrieve your location.";switch(o.code){case o.PERMISSION_DENIED:t="Location access denied. Please allow location access in your browser settings.";break;case o.POSITION_UNAVAILABLE:t="Location information is unavailable. Ensure your device has a working GPS or network connection.";break;case o.TIMEOUT:t="Location request timed out. Please try again.";break}Swal.fire({icon:"error",title:"Location Error",text:t})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):Swal.fire({icon:"error",title:"Geolocation Not Supported",text:"Your browser does not support geolocation. Please use a modern browser."})}function Q(){I.forEach(b=>b.setMap(null)),I=[]}document.addEventListener("DOMContentLoaded",()=>{const b={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};firebase.apps.length||firebase.initializeApp(b);const S=firebase.auth(),o=firebase.database(),t=document.getElementById("form-page-1"),i=document.getElementById("form-page-2"),u=document.getElementById("nextBtn"),f=document.getElementById("backBtn"),g=document.getElementById("reportId"),p=document.getElementById("dateOfReport"),d=document.getElementById("AreaOfOperation"),r=document.getElementById("calamityAreaDropdown"),N=document.getElementById("completionTime"),y=document.getElementById("StartDate"),w=document.getElementById("EndDate"),M=document.getElementById("numIndividualsFamilies"),T=document.getElementById("numFoodPacks"),C=document.getElementById("numHotMeals"),P=document.getElementById("litersWater"),x=document.getElementById("numVolunteers"),F=document.getElementById("numOrganizations"),V=document.getElementById("valueInKind"),z=document.getElementById("monetaryDonations"),H=document.getElementById("notesInfo"),L=document.getElementById("pinBtn"),O=document.getElementById("mapModal"),K=document.querySelector(".closeBtn");if(!t||!i||!u||!f||!g||!p||!d||!r||!N||!y||!w||!M||!T||!C||!P||!x||!F||!V||!z||!H){console.error("One or more essential form elements not found. Please check HTML IDs.");return}let k=null,E="[Unknown Org]",h=[];function W(){r.innerHTML='<option value="">-- Select an Active Operation --</option>',h.forEach(n=>{const l=document.createElement("option");l.value=n.id;let s=n.calamityType;n.calamityType==="Typhoon"&&n.typhoonName&&(s+=` (${n.typhoonName})`),l.textContent=`${s} (by ${n.organization})`,r.appendChild(l)});const e=JSON.parse(localStorage.getItem("reportData"));e&&e.CalamityAreaId&&(r.value=e.CalamityAreaId,r.value&&r.dispatchEvent(new Event("change")))}r.addEventListener("change",()=>{const e=r.value;e===""?(d.value="",d.readOnly=!1):(h.find(l=>l.id===e)||(console.warn("Selected activation not found in activeActivations array."),d.value=""),d.readOnly=!1),L&&(L.style.display="inline-block")}),S.onAuthStateChanged(e=>{e?(k=e.uid,console.log("Logged-in user UID:",k),o.ref(`users/${k}`).once("value",n=>{const l=n.val();l&&l.group?(E=l.group,console.log("Volunteer group fetched from database for filtering:",E)):console.warn("User data or group not found in database for UID:",k);let s=o.ref("activations").orderByChild("status").equalTo("active");E&&E!=="[Unknown Org]"?(console.log(`Filtering activations for group: ${E}`),s.on("value",c=>{h=[],c.forEach(m=>{const v={id:m.key,...m.val()};v.organization===E&&h.push(v)}),W()},c=>{console.error("Error listening for active activations with group filter:",c),Swal.fire({icon:"error",title:"Error",text:"Failed to load active operations. Please try again."})})):(console.log("Showing all active activations (Unknown Org or no group)."),s.on("value",c=>{h=[],c.forEach(m=>{h.push({id:m.key,...m.val()})}),W()},c=>{console.error("Error listening for all active activations:",c),Swal.fire({icon:"error",title:"Error",text:"Failed to load active operations. Please try again."})}))}).catch(n=>{console.error("Error fetching user data:",n),Swal.fire({icon:"error",title:"Error",text:"Failed to fetch user group. Please try again."})})):(console.warn("No user is logged in"),window.location.href="../pages/login.html")});const Z=new Date().toLocaleDateString("en-CA");p.value=Z;const _=document.getElementById("reportId");if(_){const e="ABRN"+Math.floor(1e4+Math.random()*9e9);_.value=e}L&&O&&K?(L.addEventListener("click",e=>{e.preventDefault(),console.log("Pin button clicked!"),O.classList.add("show"),console.log("mapModal classList:",O.classList),a?setTimeout(()=>{if(a){google.maps.event.trigger(a,"resize");const n=d.value;n?new google.maps.Geocoder().geocode({address:n},(s,c)=>{if(c==="OK"&&s[0]){a.setCenter(s[0].geometry.location),I.forEach(v=>v.setMap(null)),I=[];const m=new google.maps.Marker({map:a,position:s[0].geometry.location,title:n});I.push(m)}}):(a.setCenter({lat:12.8797,lng:121.774}),a.setZoom(6))}},100):J()}),K.addEventListener("click",()=>{O.classList.remove("show")}),window.addEventListener("click",e=>{e.target===O&&O.classList.remove("show")})):console.warn("Modal elements (pinBtn, mapModal, closeBtn) not found. Map functionality may be impaired."),u.addEventListener("click",()=>{if(console.log("Next button clicked!"),!t.checkValidity()){t.reportValidity();return}const e=y.value,n=w.value;if(!e||!n){Swal.fire({icon:"warning",title:"Missing Dates",text:"Please fill in both Start Date and End Date."}),e?w.focus():y.focus();return}const l=new Date(e+"T00:00:00"),s=new Date(n+"T00:00:00"),c=new Date;c.setHours(0,0,0,0);const m=new Date(c);if(m.setFullYear(m.getFullYear()+1),isNaN(l.getTime())||isNaN(s.getTime())){Swal.fire({icon:"error",title:"Invalid Date",text:"Invalid date entered. Please use the date picker to select valid dates."}),isNaN(l.getTime())?y.focus():w.focus();return}if(l>c){Swal.fire({icon:"warning",title:"Future Start Date",text:"Start Date cannot be a future date."}),y.focus();return}if(l>s){Swal.fire({icon:"warning",title:"Date Order Error",text:"Start Date cannot be after End Date."}),y.focus();return}if(s>m){Swal.fire({icon:"warning",title:"Excessive End Date",text:"End Date cannot be more than 1 year from today. Please enter a valid date range."}),w.focus();return}let v="",$="",G="",D="";const R=r.value;if(R){const B=h.find(q=>q.id===R);B?(v=B.calamityType,$=B.organization,G=B.typhoonName||"",D=v,G&&(D+=` (${G})`),$&&(D+=` (by ${$})`)):(console.warn("Calamity Area ID found but no matching activation data."),D=`ID: ${R} (Details Missing)`)}else console.warn("No Calamity Area selected."),D="Not Specified";t.style.display="none",i.style.display="block";const Y={userUid:k,VolunteerGroupName:E,AreaOfOperation:d.value,CalamityAreaId:r.value,CalamityName:v,CalamityAreaDetails:D,TimeOfIntervention:N.value,DateOfReport:p.value,ReportID:g.value,StartDate:y.value,EndDate:w.value,NoOfIndividualsOrFamilies:M.value,NoOfFoodPacks:T.value,NoOfHotMeals:C.value,LitersOfWater:P.value,NoOfVolunteersMobilized:x.value,NoOfOrganizationsActivated:F.value,TotalValueOfInKindDonations:V.value,TotalMonetaryDonations:z.value,NotesAdditionalInformation:H.value,Status:"Pending"};localStorage.setItem("reportData",JSON.stringify(Y)),console.log("Form data saved to localStorage:",Y)}),f.addEventListener("click",()=>{i.style.display="none",t.style.display="block"}),i.addEventListener("submit",function(e){e.preventDefault(),window.location.href="../pages/reportsSummary.html"});const U=localStorage.getItem("returnToStep");if(U){const e=JSON.parse(localStorage.getItem("reportData"));e&&(g.value=e.ReportID||"",p.value=e.DateOfReport||"",d.value=e.AreaOfOperation||"",e.CalamityAreaId&&(r.value=e.CalamityAreaId,r.dispatchEvent(new Event("change"))),N.value=e.TimeOfIntervention||"",y.value=e.StartDate||"",w.value=e.EndDate||"",M.value=e.NoOfIndividualsOrFamilies||"",T.value=e.NoOfFoodPacks||"",C.value=e.NoOfHotMeals||"",P.value=e.LitersOfWater||"",x.value=e.NoOfVolunteersMobilized||"",F.value=e.NoOfOrganizationsActivated||"",V.value=e.TotalValueOfInKindDonations||"",z.value=e.TotalMonetaryDonations||"",NotesAdditionalInformation.value=e.NotesAdditionalInformation||""),U==="form-container-1"?(t.style.display="block",i.style.display="none"):U==="form-container-2"&&(t.style.display="none",i.style.display="block"),localStorage.removeItem("returnToStep")}else t.style.display="block",i.style.display="none"});
