import"./global-Dd8t204S.js";/* empty css                */document.addEventListener("DOMContentLoaded",()=>{const R={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};let u,E;try{firebase.initializeApp(R),u=firebase.database(),E=firebase.auth()}catch(e){console.error("Firebase initialization failed:",e),Swal.fire({icon:"error",title:"Initialization Error",text:"Failed to initialize Firebase. Please try again later."});return}let I=[];const w=document.getElementById("submittedReportsContainer"),v=document.getElementById("pagination"),N=document.getElementById("entriesInfo"),D=document.getElementById("searchInput"),y=document.getElementById("sortSelect");let l=1;const g=5;if(!w||!v||!N||!D||!y){console.error("Required DOM elements not found"),Swal.fire({icon:"error",title:"Page Error",text:"Required elements are missing on the page. Please contact support."});return}E.onAuthStateChanged(e=>{if(!e){Swal.fire({icon:"error",title:"Authentication Required",text:"Please sign in to access report verification."}).then(()=>{window.location.href="../pages/login.html"});return}B()});function h(e){const o=new Date(e);return isNaN(o)?e||"-":o.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function $(e){if(!e)return"-";let o;return e.includes("T")?o=new Date(e):o=new Date(`1970-01-01T${e}`),isNaN(o)?e:o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function C(e){return{firebaseKey:e.firebaseKey,ReportID:e.reportID||e.ReportID||"-",VolunteerGroupName:e.organization||e.VolunteerGroupName||"[Unknown Org]",AreaOfOperation:e.AreaOfOperation||"-",TimeOfIntervention:e.timeOfIntervention||e.TimeOfIntervention||"-",DateOfReport:e.dateOfReport||e.DateOfReport||"-",Status:e.status||e.Status||"Pending",StartDate:e.operationDate||e.StartDate||"-",EndDate:e.operationDate||e.EndDate||"-",NoOfIndividualsOrFamilies:e.families||e.NoOfIndividualsOrFamilies||"-",NoOfFoodPacks:e.foodPacks||e.NoOfFoodPacks||"-",NoOfHotMeals:e.hotMeals||e.NoOfHotMeals||"-",LitersOfWater:e.water||e.LitersOfWater||"-",NoOfVolunteersMobilized:e.volunteers||e.NoOfVolunteersMobilized||"-",NoOfOrganizationsActivated:e.NoOfOrganizationsActivated||"-",TotalValueOfInKindDonations:e.inKindValue||e.TotalValueOfInKindDonations||"-",TotalMonetaryDonations:e.amountRaised||e.TotalMonetaryDonations||"-",NotesAdditionalInformation:e.remarks||e.urgentNeeds||e.NotesAdditionalInformation||"-",userUid:e.userUid||"-",submittedBy:e.submittedBy||"-"}}function B(){u.ref("reports/submitted").on("value",e=>{I=[];const o=e.val();o?Object.keys(o).forEach(r=>{const t=o[r];!t.VolunteerGroupName&&!t.organization&&console.warn(`Report ${r} is missing VolunteerGroupName/organization field. Will fetch dynamically on approval.`);const d=C({firebaseKey:r,...t});I.push(d)}):console.log("No submitted reports found in Firebase"),b()},e=>{console.error("Error fetching reports from Firebase:",e),Swal.fire({icon:"error",title:"Error",text:"Failed to load reports: "+e.message})})}function L(e){if(w.innerHTML="",e.length===0){w.innerHTML="<tr><td colspan='9'>No submitted reports found on this page.</td></tr>",N.textContent="Showing 0 to 0 of 0 entries",T(0);return}e.forEach((t,d)=>{const c=document.createElement("tr"),O=(l-1)*g+d+1;c.innerHTML=`
                <td>${O}</td>
                <td>${t.ReportID||"-"}</td>
                <td>${t.VolunteerGroupName||"[Unknown Org]"}</td>
                <td>${t.AreaOfOperation||"-"}</td>
                <td>${$(t.TimeOfIntervention)}</td>
                <td>${h(t.DateOfReport)}</td>
                <td>${t.Status||"Pending"}</td>
                <td>
                    <button class="viewBtn">View</button>
                    <button class="approveBtn">Approve</button>
                    <button class="rejectBtn">Reject</button>
                </td>
            `,c.querySelector(".viewBtn").addEventListener("click",()=>{const a=document.getElementById("reportModal"),i=document.getElementById("modalReportDetails"),n=document.getElementById("closeModal");if(!a||!i||!n){console.error("Modal elements not found"),Swal.fire({icon:"error",title:"Error",text:"Modal elements are missing. Please contact support."});return}i.innerHTML=`
                    <div class="report-section">
                        <div class="form-1">
                            <h2>Basic Information</h2>
                            <p><strong>Report ID:</strong> ${t.ReportID||"-"}</p>
                            <p><strong>Volunteer Group:</strong> ${t.VolunteerGroupName||"[Unknown Org]"}</p> 
                            <p><strong>Date of Report Submitted:</strong> ${h(t.DateOfReport)}</p>
                            <p class="cell"><strong>Location of Operation:</strong> ${t.AreaOfOperation||"-"}</p>
                        </div>
                        <div class="form-2">
                            <h2>Relief Operations</h2>
                            <p class="cell"><strong>Completion Time of Intervention:</strong> ${$(t.TimeOfIntervention)}</p>
                            <p><strong>Start Date of Operation:</strong> ${h(t.StartDate)||"-"}</p>
                            <p><strong>End Date of Operation:</strong> ${h(t.EndDate)||"-"}</p>
                            <p><strong>No. of Individuals or Families:</strong> ${t.NoOfIndividualsOrFamilies||"-"}</p>
                            <p><strong>No. of Food Packs:</strong> ${t.NoOfFoodPacks||"-"}</p>
                            <p><strong>No. of Hot Meals/Ready-to-eat food:</strong> ${t.NoOfHotMeals||"-"}</p>
                            <p><strong>Liters of Water:</strong> ${t.LitersOfWater||"-"}</p>
                            <p><strong>No. of Volunteers Mobilized:</strong> ${t.NoOfVolunteersMobilized||"-"}</p>
                            <p><strong>No. of Organizations Activated:</strong> ${t.NoOfOrganizationsActivated||"-"}</p>
                            <p><strong>Total Value of In-Kind Donations:</strong> ${t.TotalValueOfInKindDonations||"-"}</p>
                            <p><strong>Total Monetary Donations:</strong> ${t.TotalMonetaryDonations||"-"}</p>
                        </div>
                    </div>
                    <div class="form-3">
                        <h2>Additional Updates</h2>
                        <p><strong>Notes/Additional Information:</strong> ${t.NotesAdditionalInformation||"-"}</p>
                    </div>
                `,a.classList.remove("hidden"),n.addEventListener("click",()=>{a.classList.add("hidden")}),window.addEventListener("click",function(s){s.target===a&&a.classList.add("hidden")})}),c.querySelector(".approveBtn").addEventListener("click",()=>{const a=t.userUid;if(!a){Swal.fire({icon:"error",title:"Error",text:"User UID not found in report. Cannot approve."});return}u.ref(`users/${a}`).once("value").then(i=>{const n=i.val();let s="[Unknown Org]";return n&&n.group?(s=n.group,console.log(`Workspaceed VolunteerGroupName for user ${a}: ${s}`)):console.warn(`No group found for user ${a}. Using default: [Unknown Org]`),t.VolunteerGroupName=s,t.Status="Approved",Promise.all([u.ref("reports/approved").push(t),u.ref(`users/${a}/reports/${t.firebaseKey}`).set({...t,Status:"Approved"}),u.ref(`reports/submitted/${t.firebaseKey}`).remove()])}).then(()=>{Swal.fire({icon:"success",title:"Report Approved",text:"The report has been approved and moved to the approved logs.",background:"#f0fdf4",color:"#065f46",iconColor:"#059669",confirmButtonColor:"#059669",customClass:{popup:"swal2-popup-success-clean",title:"swal2-title-success-clean",content:"swal2-text-success-clean"}})}).catch(i=>{console.error("Error during report approval:",i),Swal.fire({icon:"error",title:"Approval Failed",text:`Failed to approve report: ${i.message}`,background:"#fef2f2",color:"#7f1d1d",iconColor:"#dc2626",confirmButtonColor:"#b91c1c",customClass:{popup:"swal2-popup-error-clean",title:"swal2-title-error-clean",content:"swal2-text-error-clean"}})})}),c.querySelector(".rejectBtn").addEventListener("click",()=>{const a=t.userUid;if(!a){Swal.fire({icon:"error",title:"Error",text:"User UID not found in report. Cannot reject."});return}Promise.all([u.ref(`reports/submitted/${t.firebaseKey}`).remove(),u.ref(`users/${a}/reports/${t.firebaseKey}`).remove()]).then(()=>{Swal.fire({icon:"info",title:"Report Rejected",text:"The report has been rejected and removed.",background:"#fef2f2",color:"#7f1d1d",iconColor:"#dc2626",confirmButtonColor:"#b91c1c",customClass:{popup:"swal2-popup-rejected-clean",title:"swal2-title-rejected-clean",content:"swal2-text-rejected-clean"}})}).catch(i=>{console.error("Error during report rejection:",i),Swal.fire({icon:"error",title:"Error",text:"Failed to reject report: "+i.message})})}),w.appendChild(c)});const o=(l-1)*g+1,r=Math.min(l*g,e.length);N.textContent=`Showing ${o} to ${r} of ${e.length} entries`}function T(e){v.innerHTML="";const o=Math.ceil(e/g),r=(t,d=null,c=!1,O=!1)=>{const f=document.createElement("button");return f.textContent=t,c&&(f.disabled=!0),O&&f.classList.add("active-page"),d!==null&&f.addEventListener("click",()=>{l=d,b()}),f};v.appendChild(r("Prev",l-1,l===1));for(let t=1;t<=o;t++)v.appendChild(r(t,t,!1,t===l));v.appendChild(r("Next",l+1,l===o))}function b(){const e=D.value.toLowerCase(),o=y.value,[r,t]=o.split("-");let d=I.filter(a=>Object.entries(a).some(([i,n])=>i==="DateOfReport"?h(n).toLowerCase().includes(e):i==="TimeOfIntervention"?$(n).toLowerCase().includes(e):n==null?void 0:n.toString().toLowerCase().includes(e)));r&&d.sort((a,i)=>{const n=a[r]||"",s=i[r]||"";if(r==="DateOfReport"){const p=new Date(n),m=new Date(s);return isNaN(p)||isNaN(m)?0:t==="asc"?p-m:m-p}else if(r==="TimeOfIntervention"){const p=new Date(n.includes("T")?n:`1970-01-01T${n}`).getTime(),m=new Date(s.includes("T")?s:`1970-01-01T${s}`).getTime();return isNaN(p)||isNaN(m)?0:t==="asc"?p-m:m-p}return t==="asc"?n.toString().localeCompare(s.toString()):s.toString().localeCompare(n.toString())});const c=(l-1)*g,O=c+g,f=d.slice(c,O);L(f),T(d.length)}D.addEventListener("input",()=>{l=1,b()}),y.addEventListener("change",()=>{l=1,b()}),window.clearDInputs=()=>{D.value="",l=1,b()};const S=document.getElementById("viewApprovedBtn");S&&S.addEventListener("click",()=>{window.location.href="../pages/reportslog.html"})});
