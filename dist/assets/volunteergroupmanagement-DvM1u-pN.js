import"./global-Dd8t204S.js";/* empty css                */const H={apiKey:"AIzaSyDJxMv8GCaMvQT2QBW3CdzA3dV5X_T2KqQ",authDomain:"bayanihan-5ce7e.firebaseapp.com",databaseURL:"https://bayanihan-5ce7e-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"bayanihan-5ce7e",storageBucket:"bayanihan-5ce7e.appspot.com",messagingSenderId:"593123849917",appId:"1:593123849917:web:eb85a63a536eeff78ce9d4",measurementId:"G-ZTQ9VXXVV0"};try{firebase.initializeApp(H),console.log("Firebase initialized successfully:",firebase.app().name)}catch(e){console.error("Firebase initialization failed:",e),Swal.fire({icon:"error",title:"Initialization Error",text:"Failed to initialize Firebase. Check configuration."})}const L=firebase.auth(),d=firebase.database();try{firebase.initializeApp(H,"SecondaryApp"),console.log("Secondary Firebase app initialized successfully")}catch(e){console.error("Secondary Firebase initialization failed:",e)}const F=firebase.auth(firebase.app("SecondaryApp"));try{emailjs.init("ULA8rmn7VM-3fZ7ik"),console.log("EmailJS initialized successfully")}catch(e){console.error("EmailJS initialization failed:",e)}function R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let n=0;n<8;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}let g=[];const Q=["Abra","Agusan del Norte","Agusan del Sur","Aklan","Albay","Antique","Apayao","Aurora","Basilan","Bataan","Batanes","Batangas","Benguet","Biliran","Bohol","Bukidnon","Bulacan","Cagayan","Camarines Norte","Camarines Sur","Camiguin","Capiz","Catanduanes","Cavite","Cebu","Cotabato","Davao del Norte","Davao del Sur","Davao Oriental","Dinagat Islands","Eastern Samar","Guimaras","Ifugao","Ilocos Norte","Ilocos Sur","Iloilo","Isabela","Kalinga","La Union","Laguna","Lanao del Norte","Lanao del Sur","Leyte","Maguindanao","Marinduque","Masbate","Mindoro Occidental","Mindoro Oriental","Misamis Occidental","Misamis Oriental","Mountain Province","Negros Occidental","Negros Oriental","Northern Samar","Nueva Ecija","Nueva Vizcaya","Palawan","Pampanga","Pangasinan","Quezon","Quirino","Rizal","Romblon","Samar","Sarangani","Siquijor","Sorsogon","South Cotabato","Southern Leyte","Sultan Kudarat","Sulu","Surigao del Norte","Surigao del Sur","Tarlac","Tawi-Tawi","Zambales","Zamboanga del Norte","Zamboanga del Sur","Zamboanga Sibugay"],P={"Camarines Sur":["Naga City","Iriga City","Goa","Pili","Tinambac","Calabanga","Sipocot","Tigaon"]},$={"Naga City":["Concepcion Pequena","San Felipe","Tinago","Mabolo","Abella","Balatas","Igualdad","Sabang"]},z=5;let c=1,i=null,I=!1;const C=document.querySelector("#orgTable tbody"),T=document.querySelector("#entriesInfo"),p=document.querySelector("#pagination"),E=document.getElementById("addNew"),h=document.getElementById("addOrgModal"),B=document.getElementById("addOrgForm"),y=document.getElementById("sortSelect"),f=document.getElementById("searchInput"),m=document.querySelector(".clear-btn");C||console.error("Table body (#orgTable tbody) not found.");T||console.error("Entries info (#entriesInfo) not found.");p||console.error("Pagination container (#pagination) not found.");E||console.error("Add new button (#addNew) not found.");h||console.error("Add org modal (#addOrgModal) not found.");B||console.error("Add org form (#addOrgForm) not found.");y||console.error("Sort select (#sortSelect) not found.");f||console.error("Search input (#searchInput) not found.");m||console.error("Clear button (.clear-btn) not found.");document.addEventListener("mousemove",e=>{if(!E)return;const t=window.innerWidth,n=window.innerHeight,a=t-e.clientX,o=n-e.clientY;a<200&&o<200?E.classList.add("visible"):E.classList.remove("visible")});function q(e){let t=e.replace(/\D/g,"");return t.startsWith("63")&&t.length===12&&(t="0"+t.slice(2)),/^\d{10,15}$/.test(t)?t:null}function M(){console.log("Checking authentication state..."),L.onAuthStateChanged(e=>{if(console.log("User state:",e?`Signed in as ${e.uid}`:"No user signed in"),!e){Swal.fire({icon:"warning",title:"Authentication Required",text:"Please sign in as an admin to view volunteer groups.",timer:2e3,showConfirmButton:!1}),setTimeout(()=>{window.location.replace("../pages/login.html")},2e3);return}console.log("Fetching volunteerGroups..."),d.ref("volunteerGroups").once("value").then(t=>{const n=t.val();if(console.log("Fetched volunteerGroups:",n),!n){console.warn("No data found in volunteerGroups node."),g=[],b(),Swal.fire({icon:"info",title:"No Data",text:"No volunteer groups found in the database."});return}g=Object.entries(n).map(([a,o])=>({no:parseInt(a),organization:o.organization||"N/A",hq:o.hq||"N/A",areaOfOperation:o.areaOfOperation||"N/A",contactPerson:o.contactPerson||"N/A",email:o.email||"N/A",mobileNumber:o.mobileNumber||"N/A",socialMedia:o.socialMedia||"N/A",activation:o.activation||"N/A",calamityType:o.calamityType||"N/A"})),console.log("Processed Data:",g),g.sort((a,o)=>a.no-o.no),b()}).catch(t=>{console.error("Error fetching volunteerGroups:",t);let n="Failed to fetch data. Check network or database.";t.code==="PERMISSION_DENIED"&&(n="Permission denied. Ensure database rules allow read access."),Swal.fire({icon:"error",title:"Fetch Error",text:n}),g=[],b()})})}function b(e=g){if(console.log("Rendering table with data:",e),!C)return;C.innerHTML="";const t=(c-1)*z,n=t+z,a=e.slice(t,n);console.log("Page data:",a),a.forEach(o=>{const r=document.createElement("tr");r.innerHTML=`
      <td>${o.no}</td>
      <td>${o.organization}</td>
      <td class="hqCell">${o.hq}</td>
      <td class="locationCell">${o.areaOfOperation}</td>
      <td>${o.contactPerson}</td>
      <td>${o.email}</td>
      <td>${o.mobileNumber}</td>
      <td>${o.socialMedia}</td>
      <td>
        <button class="editBtn" data-id="${o.no}">Edit</button>
        <button class="deleteBtn" data-id="${o.no}">Remove</button>
      </td>
    `,C.appendChild(r)}),T&&(T.textContent=`Showing ${t+1} to ${Math.min(n,e.length)} of ${e.length} entries`),Z(e.length),_()}function W(){if(!f)return;const e=f.value.trim().toLowerCase();m&&(m.style.display=e?"flex":"none"),c=1,b(N())}function Y(){!f||!m||(f.value="",m.style.display="none",c=1,b(N()))}m&&(m.style.display="none",m.addEventListener("click",Y));f&&f.addEventListener("input",W);function N(){let e=g.filter(t=>Object.values(t).some(n=>typeof n=="string"||typeof n=="number"?n.toString().toLowerCase().includes(f.value.trim().toLowerCase()):!1));return y&&y.value&&e.sort((t,n)=>t[y.value].toString().localeCompare(n[y.value].toString())),e}y&&y.addEventListener("change",()=>{c=1,b(N())});function Z(e){if(!p)return;p.innerHTML="";const t=Math.ceil(e/z);if(t===0){p.textContent="No entries to display";return}const n=(a,o,r=!1,l=!1)=>{const s=document.createElement("button");return s.textContent=a,r&&(s.disabled=!0),l&&s.classList.add("active-page"),o!==null&&s.addEventListener("click",()=>{c=o,b(N())}),s};p.appendChild(n("Prev",c>1?c-1:null,c===1));for(let a=1;a<=t;a++)p.appendChild(n(a,a,!1,a===c));p.appendChild(n("Next",c<t?c+1:null,c===t))}function _(){document.querySelectorAll(".editBtn").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest("tr"),n=e.getAttribute("data-id"),a=t.querySelectorAll("td");if(!(a[0].getAttribute("contenteditable")==="true"))a.forEach((r,l)=>{l<a.length-1&&r.setAttribute("contenteditable","true")}),e.textContent="Save";else{const r={organization:a[1].textContent.trim()||"N/A",hq:a[2].textContent.trim()||"N/A",areaOfOperation:a[3].textContent.trim()||"N/A",contactPerson:a[4].textContent.trim()||"N/A",email:a[5].textContent.trim()||"N/A",mobileNumber:a[6].textContent.trim()||"N/A",socialMedia:a[7].textContent.trim()||"N/A"};d.ref(`volunteerGroups/${n}`).update(r).then(()=>{a.forEach((l,s)=>{s<a.length-1&&l.setAttribute("contenteditable","false")}),e.textContent="Edit",M()}).catch(l=>{console.error("Update error:",l),Swal.fire({icon:"error",title:"Update Error",text:l.message})})}})}),document.querySelectorAll(".deleteBtn").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-id");Swal.fire({icon:"warning",title:"Are you sure?",text:"This will remove the volunteer group from the list but keep it in the database for future access.",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(n=>{n.isConfirmed&&d.ref(`volunteerGroups/${t}`).once("value").then(a=>{const o=a.val();if(!o)throw new Error("Group not found.");return d.ref(`deletedVolunteerGroups/${t}`).set({...o,deletedAt:new Date().toISOString()})}).then(()=>d.ref(`volunteerGroups/${t}`).remove()).then(()=>{Swal.fire({icon:"success",title:"Deleted",text:"Volunteer group has been moved to the deleted list."}),M()}).catch(a=>{console.error("Delete error:",a),Swal.fire({icon:"error",title:"Delete Error",text:a.message})})})})})}function K(e,t){const n=document.getElementById(t?"locCityOptions":"hqCityOptions");n&&(n.innerHTML="",P[e]&&P[e].forEach(a=>{const o=document.createElement("option");o.value=a,n.appendChild(o)}))}function X(e,t){const n=document.getElementById(t?"locBarangayOptions":"hqBarangayOptions");n&&(n.innerHTML="",$[e]&&$[e].forEach(a=>{const o=document.createElement("option");o.value=a,n.appendChild(o)}))}["hqProvinceInput","locProvinceInput"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",n=>K(n.target.value,e.includes("loc")))});["hqCityInput","locCityInput"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",n=>X(n.target.value,e.includes("loc")))});E&&E.addEventListener("click",()=>{h&&(h.style.display="flex")});function J(){const e=document.getElementById("addOrgForm"),t=document.getElementById("areaOperationContainer");e&&(e.reset(),e.mobileNumber.value=""),t&&(t.innerHTML="")}const G=document.getElementById("addOperationArea");G&&G.addEventListener("click",()=>{ee(),te(),ne();const e=document.getElementById("areaOperationModal");e&&(e.style.display="flex")});function ee(){const e=document.getElementById("provinceList");e&&(e.innerHTML="",Q.forEach(t=>{const n=document.createElement("option");n.value=t,e.appendChild(n)}))}function te(){const e=document.getElementById("cityList");e&&(e.innerHTML="",Object.values(P).flat().forEach(t=>{const n=document.createElement("option");n.value=t,e.appendChild(n)}))}function ne(){const e=document.getElementById("barangayList");e&&(e.innerHTML="",Object.values($).flat().forEach(t=>{const n=document.createElement("option");n.value=t,e.appendChild(n)}))}const O=document.getElementById("areaOperationForm");O&&O.addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("provinceInput").value.trim(),n=document.getElementById("cityInput").value.trim(),a=document.getElementById("barangayInput").value.trim();if(!t||!n||!a){Swal.fire({icon:"error",title:"Incomplete Input",text:"Please fill all fields."});return}const o=document.createElement("input");o.type="text",o.name="Area Operation",o.value=`${a}, ${n}, ${t}`,o.readOnly=!0,o.style.marginTop="10px",o.style.width="100%",o.style.maxWidth="520px",o.style.padding="10px 14px",o.style.border="#605D67 1px solid",o.style.borderRadius="12px";const r=document.getElementById("areaOperationContainer");r&&r.appendChild(o),O.reset();const l=document.getElementById("areaOperationModal");l&&(l.style.display="none")});B&&B.addEventListener("submit",async e=>{e.preventDefault();const t=B,n=t.email.value.trim(),a=t.mobileNumber.value.trim(),o=u=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u),r=q(a);if(!o(n)){Swal.fire({icon:"error",title:"Invalid Email",text:"Please enter a valid email address."});return}if(!r){Swal.fire({icon:"error",title:"Invalid Mobile Number",text:"Mobile number must be 10-15 digits (e.g., 091xxxxxxxx or +639xxxxxxxxx)."});return}if(!t.checkValidity()){t.reportValidity();return}const l=Array.from(document.querySelectorAll("#areaOperationContainer input")).map(u=>u.value);if(!l.length){Swal.fire({icon:"error",title:"Invalid Input",text:"At least one area of operation is required."});return}i={organization:t.organization.value.trim(),hq:`${t["hq-barangay"].value}, ${t["hq-city"].value}, ${t["hq-province"].value}`,areaOps:l,contactPerson:t.contactPerson.value.trim(),email:n,mobileNumber:r,socialMedia:t.socialMedia.value.trim()||"N/A"};const s=document.getElementById("confirmDetails");s&&(s.innerHTML=`
        <p><strong style="color: #4059A5;">Organization</strong> ${i.organization}</p>
        <p><strong style="color: #4059A5;">HQ</strong> ${i.hq}</p>
        <p><strong style="color: #4059A5;">Contact Person</strong> ${i.contactPerson}</p>
        <p><strong style="color: #4059A5;">Email</strong> ${i.email}</p>
        <p><strong style="color: #4059A5;">Mobile</strong> ${i.mobileNumber}</p>
        <p><strong style="color: #4059A5;">Social Media</strong> ${i.socialMedia}</p>
        <p><strong style="color: #4059A5;">Area of Operations</strong></p>
        <ul style="padding-left:20px;">${i.areaOps.map(u=>`<li>${u}</li>`).join("")}</ul>
      `),h&&(h.style.display="none");const x=document.getElementById("confirmModal");x&&(x.style.display="block")});const V=document.getElementById("editDetailsBtn");V&&V.addEventListener("click",()=>{const e=document.getElementById("confirmModal");e&&(e.style.display="none"),h&&(h.style.display="block")});const S=document.getElementById("confirmSaveBtn");S&&S.addEventListener("click",async()=>{var t;if(I)return;if(I=!0,S.disabled=!0,!i){Swal.fire({icon:"error",title:"Error",text:"No organization data found."}),I=!1,S.disabled=!1;return}const e={organization:i.organization,hq:i.hq,areaOfOperation:i.areaOps.join(", ")||"N/A",contactPerson:i.contactPerson,email:i.email||"N/A",mobileNumber:i.mobileNumber,socialMedia:i.socialMedia,activation:"",calamityType:""};try{const n=L.currentUser;if(!n)throw new Error("No admin signed in. Please sign in again.");console.log("Current admin:",n.uid);const o=(await d.ref("users").once("value")).val();if(console.log("All users in database:",o),o)for(const v of Object.values(o)){const w=q(v.mobile),A=q(i.mobileNumber);if(console.log(`Comparing mobile: ${A} with stored: ${v.mobile} -> ${w}`),w===null||A===null){console.log(`Skipping comparison due to invalid mobile number: ${A} vs ${w}`);continue}if(w===A)throw console.log(`Match found! Mobile number ${i.mobileNumber} already registered for user:`,v),new Error("Mobile number already registered.")}const r=R();let l;try{l=await F.createUserWithEmailAndPassword(i.email,r)}catch(v){throw v.code==="auth/email-already-in-use"?new Error("Email already registered in Firebase Authentication. Please use a different email."):new Error("Error creating user in Firebase Authentication: "+v.message)}const s=l.user;await d.ref(`users/${s.uid}`).set({role:"ABVN",group:i.organization,email:i.email,mobile:i.mobileNumber,organization:i.organization,contactPerson:i.contactPerson,createdAt:new Date().toISOString(),isFirstLogin:!0,emailVerified:!1,password_needs_reset:!0});const u=(await d.ref("volunteerGroups").once("value")).val(),U=u?Math.max(...Object.keys(u).map(Number))+1:1;await d.ref(`volunteerGroups/${U}`).set({...e,userId:s.uid}),await emailjs.send("service_g5f0erj","template_0yk865p",{email:i.email,organization:i.organization,tempPassword:r,message:`Your volunteer group "${i.organization}" has been successfully registered with Bayanihan. Please use the credentials below to log in. You will be prompted to verify your email and reset your password upon your first login.`,verification_message:"Please log in using the provided email and temporary password. You will be prompted to verify your email and reset your password upon your first login."}),Swal.fire({icon:"success",title:"Success",text:"Volunteer group added successfully! An email with login credentials has been sent to the user."}),i=null;const D=document.getElementById("confirmModal"),k=document.getElementById("successModal");D&&(D.style.display="none"),k&&(k.style.display="block"),M(),await F.signOut()}catch(n){console.error("Error adding volunteer group:",n),Swal.fire({icon:"error",title:"Error",text:`Failed to add group: ${n.message}`})}finally{I=!1,S.disabled=!1,console.log("Admin still signed in:",(t=L.currentUser)==null?void 0:t.uid)}});const j=document.getElementById("closeSuccessBtn");j&&j.addEventListener("click",()=>{J();const e=document.getElementById("successModal");e&&(e.style.display="none")});document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, fetching data..."),M()});
